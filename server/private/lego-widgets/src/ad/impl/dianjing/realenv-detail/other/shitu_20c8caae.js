F.module("/static/widget/common/shitu/shitu.js",function(d,b){var c=d("/static/common/lib/tangram/base/base.js");var a;var e=b=function(){this.point=document.getElementById("point");this.content=document.getElementById("stsug");this.submitobj=document.getElementById("sbobj");this.form=document.getElementById("form1");this.form2=document.getElementById("form2");this.file=document.getElementById("stfile");this.url=document.getElementById("stuurl");this.entry=document.getElementById("sttb");this.close=document.getElementById("closest");this.tips=document.getElementById("stmore");this.hpobj=document.getElementById("hp");this.sthp=document.getElementById("sthelp");this.draghp=document.getElementById("dragtip");this.kw=document.getElementById("kw");this.dragts=document.getElementById("dragtg");this.clickurl="http://stu.baidu.com";this.onuploadtg=0;this.ftn=document.getElementById("stftn").value||"";this.isDisplay=0;this.isSubmit=0;this.chrome=/chrome\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp["\x241"]:undefined;this.isIe=/msie (\d+\.\d+)/i.test(navigator.userAgent)?(document.documentMode||+RegExp["\x241"]):undefined;this.isOpera=/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp["\x246"]||RegExp["\x242"]):undefined;this.callbacks={aftershow:{},beforehide:{}}};e.prototype={init:function(){var h=this,g=h.addEvent,f=h.content;h.initdisplay();g(window,"load",function(i){h.initdisplay()});g(document,"click",function(i){h.hiddenContent(i,0);window.setTimeout(function(){if(!h.isDisplay&&!h.isSubmit){h.closest()}},10)});g(document,"mousemove",function(i){h.hiddenContent(i,1);window.setTimeout(function(){if(!h.isDisplay&&!h.isSubmit){h.closest()}},10)});g(h.entry,"click",function(i){h._imgReq(h.clickurl+"/5.gif?rk=1&ftn="+h.ftn+"&t="+(new Date()).getTime());h.isDisplay=1;h.displayst()});g(h.sthp,"mouseover",function(i){h.tips.style.display=""});g(h.sthp,"mouseout",function(i){a=setTimeout(function(){h.tips.style.display="none"},1000)});g(h.tips,"mouseover",function(i){i=window.event||i;if(h.fixedMouse(i,h.tips)){if(a){clearTimeout(a)}}});g(h.tips,"mouseout",function(i){i=window.event||i;if(h.fixedMouse(i,h.tips)){h.tips.style.display="none"}});g(h.file,"change",function(i){h.getValue()});g(h.submitobj,"click",function(j){var k=h.url.value,i=(k=="")||!h.checkImgType(k),j=window.event||j;if(i){alert("您的文件格式不正确或图片网址过长。支持jpg、gif、png、jpeg、bmp格式图片及250个字符内的图片网址。");if(document.all){j.returnValue=false}else{j.preventDefault()}this.form.reset()}else{h.point.style.display="block"}});g(h.close,"click",function(i){if(h.onuploadtg){h.isIe?window.document.execCommand("Stop"):window.stop()}h._imgReq(h.clickurl+"/5.gif?gb=1&ftn="+h.ftn+"&t="+(new Date()).getTime());h.form.reset();h.form2.reset();h.isSubmit=0;if(h.onuploadtg){h.draghp.style.display="none";h.point.style.display="none";h.onuploadtg=0;return}h.closest()});if(h.isOpera||!window.FileReader){return}g(document,"dragenter",function(i){if(h.sugTg!==1){return}h.point.style.display="none";h.displayst();h.draghp.style.display=""});g(document,"dragover",function(i){if(h.sugTg!==1){return}h.point.style.display="none";h.displayst();h.draghp.style.display=""});g(f,"dragenter",function(i){i.stopPropagation();i.preventDefault()});g(f,"dragover",function(i){i.stopPropagation();i.preventDefault()});g(f,"drop",function(k){k.stopPropagation();k.preventDefault();h.isSubmit=1;if(k.dataTransfer.files.length){try{h.handlerFiles(k.dataTransfer.files)}catch(n){return}}else{if(k.dataTransfer.types.indexOf&&-1!=k.dataTransfer.types.indexOf("text/html")||k.dataTransfer.types.contains&&-1!=k.dataTransfer.types.contains("text/html")){var m=document.createElement("div");m.innerHTML=k.dataTransfer.getData("text/html");var l=m.getElementsByTagName("img");if(l&&l[0]&&l[0].src){var i=document.createElement("input");i.name="drag";i.value="1";i.type="hidden";h.form.appendChild(i);if(0==l[0].src.indexOf("data:")){var j=l[0].alt||l[0].title||"";h.submitForm2(l[0].src,j,"image")}else{h.url.value=l[0].src;h.form.submit()}}else{return}}else{if(k.dataTransfer.types.indexOf&&-1!=k.dataTransfer.types.indexOf("text/uri-list")){h.url.value=k.dataTransfer.getData("text/uri-list");h.form.submit()}else{return}}}h.point.style.display="block"})},initdisplay:function(){var f=this;if(f.entry){f.entry.style.display=""}if(f.dragts){f.closedg()}if(f.form){f.form.reset()}if(f.point){f.point.style.display="none"}return},closedg:function(){var f=this;if(!f.isOpera&&window.FileReader){return}if(this.dragts){this.dragts.style.display="none"}return},hiddenContent:function(i,g){var i=window.event||i,h=i.srcElement||i.target,j,f=this;while(h&&h.tagName!="BODY"&&h.tagName!="HTML"&&h.getAttribute){j=h.getAttribute("id");if(j=="stcontent"){break}h=h.parentNode}if(j=="stcontent"){return}if(g==0){f.closest();return}else{f.draghp.style.display="none";return}},fixedMouse:function(j,i){var h,f=j.type.toLowerCase(),g=this;if(f=="mouseover"){h=j.relatedTarget||j.fromElement}else{if(f=="mouseout"){h=j.relatedTarget||j.toElement}else{return true}}return h&&h.prefix!="xul"&&!this.contains(i,h)&&h!==i},contains:function(f,g){return f.contains?f!=g&&f.contains(g):!!(f.compareDocumentPosition(g)&16)},addEvent:function(h,g,f){if(h.addEventListener){h.addEventListener(g,f,false)}else{h["e"+g+f]=f;h[g+f]=function(){h["e"+g+f](window.event)};h.attachEvent("on"+g,h[g+f])}},removeEvent:function(h,g,f){if(h.detachEvent){h.detachEvent("on"+g,h[g+f]);h[g+f]=null}else{h.removeEventListener(g,f,false)}},closest:function(){this.content.style.display="none";if(this.hpobj){this.hpobj.style.display=""}this.sugTg=0;this.isDisplay=0;var f=this.callbacks.beforehide;for(var g in f){if(f[g]&&"[object Function]"==Object.prototype.toString.call(f[g])){f[g].call(this)}}},displayst:function(){this.point.style.display="none";this.content.style.display="";if(this.hpobj){this.hpobj.style.display="none"}this.sugTg=1;this.url.focus();var f=this.callbacks.aftershow;for(var g in f){if(f[g]&&"[object Function]"==Object.prototype.toString.call(f[g])){f[g].call(this)}}},checkImgType:function(h){return true;var g=new Array(".jpg",".gif",".jpeg",".png",".bmp");var l=g.length;var n=h.toLowerCase();n=n.replace(/(^\s*)/g,"");n=n.replace(/(\s*$)/g,"");var k=n.length;var f=n.substring(k-4,k);var m=n.substring(k-5,k);for(var j=0;j<l;j++){if((f==g[j])||(m==g[j])){return true}}return false},getValue:function(){var j=this.file,i=this.url,f=this.point,g=this.form2;f.style.display="none";var h=j.value;i.value=h;var k=(h!="")&&this.checkImgType(h);this.submitForm(k,g)},handlerFiles:function(j){var i=this;if(i.isOpera||!window.FileReader){return}var h=j[0],g=i.file,f=new FileReader();if(i.chrome&&!window.useFlashUp&&h&&h.size>=1024*1024){alert("拖动的图片大小不能超过1M");i.point.style.display="none";throw new Error("image file size exceed")}f.onload=(function(k){return function(o){var p=o.target.result,n=k.type;var m=p.split(",")[1];if(window.useFlashUp&&m){var l=c.swf.getMovie("STUUpload");if(l){l.setImgStrData(m,n,k.name);return}}i.submitForm2(p,k.name,n)}})(h);f.readAsDataURL(h)},_imgReq:function(f){if(!f){return}var h="log__"+(new Date()).getTime(),g=window[h]=new Image();g.onload=g.onerror=function(){window[h]=null};g.src=f;g=null},submitForm:function(g,f){if(!g){alert("您的文件格式不正确或图片网址过长。支持jpg、gif、png、jpeg、bmp格式图片及250个字符内的图片网址。");this.point.style.display="none";this.draghp.style.display="none";f.reset();return false}else{this.entry.style.zIndex="2";this.point.style.display="block";this.onuploadtg=1;f.submit();return true}},submitForm2:function(i,h,j){var k=this,g,m=document.getElementById("filename"),f=j.indexOf("image")!=-1;var l=i.replace(/\+/g,"-");if(!document.getElementById("dragimage")){g=document.createElement("input");g.name="dragimage";g.id="dragimage";g.type="hidden";k.form2.appendChild(g)}else{g=document.getElementById("dragimage")}g.value=l;m.value=h||"";f=true;k.submitForm(f,k.form2)},showLoading:function(){this.point.style.display="block"},hideLoading:function(){this.point.style.display="none"},on:function(h,f,g){if(this.callbacks[h]){this.callbacks[h][f]=g}},fire:function(g,f){if(this.callbacks[g]){this.callbacks[g][f]=null;delete this.callbacks[g][f]}}};return b},["/static/common/lib/tangram/base/base.js"]);