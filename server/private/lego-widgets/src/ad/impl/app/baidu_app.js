(function(){baidu.lang=baidu.lang||{};baidu.lang.guid=function(){return"TANGRAM$"+baidu.$$._counter++};baidu.$$._counter=baidu.$$._counter||1;baidu.lang.Class=function(){this.guid=baidu.lang.guid();!this.__decontrolled&&(baidu.$$._instances[this.guid]=this)};baidu.$$._instances=baidu.$$._instances||{};baidu.lang.Class.prototype.dispose=function(){delete baidu.$$._instances[this.guid];for(var property in this){typeof this[property]!="function"&&delete this[property]}this.disposed=true};baidu.lang.Class.prototype.toString=function(){return"[object "+(this.__type||this._className||"Object")+"]"};window.baiduInstance=function(guid){return baidu.$$._instances[guid]};baidu.lang.isString=function(source){return"[object String]"==Object.prototype.toString.call(source)};baidu.isString=baidu.lang.isString;baidu.lang.Event=function(type,target){this.type=type;this.returnValue=true;this.target=target||null;this.currentTarget=null};baidu.lang.Class.prototype.fire=baidu.lang.Class.prototype.dispatchEvent=function(event,options){baidu.lang.isString(event)&&(event=new baidu.lang.Event(event));!this.__listeners&&(this.__listeners={});options=options||{};for(var i in options){event[i]=options[i]}var i,n,me=this,t=me.__listeners,p=event.type;event.target=event.target||(event.currentTarget=me);p.indexOf("on")&&(p="on"+p);typeof me[p]=="function"&&me[p].apply(me,arguments);if(typeof t[p]=="object"){for(i=0,n=t[p].length;i<n;i++){t[p][i]&&t[p][i].apply(me,arguments)}}return event.returnValue};baidu.lang.Class.prototype.on=baidu.lang.Class.prototype.addEventListener=function(type,handler,key){if(typeof handler!="function"){return}!this.__listeners&&(this.__listeners={});var i,t=this.__listeners;type.indexOf("on")&&(type="on"+type);typeof t[type]!="object"&&(t[type]=[]);for(i=t[type].length-1;i>=0;i--){if(t[type][i]===handler){return handler}}t[type].push(handler);key&&typeof key=="string"&&(t[type][key]=handler);return handler};baidu.lang.isArray=function(source){return"[object Array]"==Object.prototype.toString.call(source)};baidu.lang.isObject=function(source){return"function"==typeof source||!!(source&&"object"==typeof source)};baidu.isObject=baidu.lang.isObject;baidu.sio=baidu.sio||{};baidu.lang.isFunction=function(source){return"[object Function]"==Object.prototype.toString.call(source)};baidu.sio._createScriptTag=function(scr,url,charset){scr.setAttribute("type","text/javascript");charset&&scr.setAttribute("charset",charset);scr.setAttribute("src",url);document.getElementsByTagName("head")[0].appendChild(scr)};baidu.sio._removeScriptTag=function(scr){if(scr.clearAttributes){scr.clearAttributes()}else{for(var attr in scr){if(scr.hasOwnProperty(attr)){delete scr[attr]}}}if(scr&&scr.parentNode){scr.parentNode.removeChild(scr)}scr=null};baidu.sio.callByServer=function(url,callback,opt_options){var scr=document.createElement("SCRIPT"),prefix="bd__cbs__",callbackName,callbackImpl,options=opt_options||{},charset=options.charset,queryField=options.queryField||"callback",timeOut=options.timeOut||0,timer,reg=new RegExp("(\\?|&)"+queryField+"=([^&]*)"),matches;if(baidu.lang.isFunction(callback)){callbackName=prefix+Math.floor(Math.random()*2147483648).toString(36);window[callbackName]=getCallBack(0)}else{if(baidu.lang.isString(callback)){callbackName=callback}else{if(matches=reg.exec(url)){callbackName=matches[2]}}}if(timeOut){timer=setTimeout(getCallBack(1),timeOut)}url=url.replace(reg,"\x241"+queryField+"="+callbackName);if(url.search(reg)<0){url+=(url.indexOf("?")<0?"?":"&")+queryField+"="+callbackName}baidu.sio._createScriptTag(scr,url,charset);function getCallBack(onTimeOut){return function(){try{if(onTimeOut){options.onfailure&&options.onfailure()}else{callback.apply(window,arguments);clearTimeout(timer)}window[callbackName]=null;delete window[callbackName]}catch(exception){}finally{baidu.sio._removeScriptTag(scr)}}}};baidu.dom=baidu.dom||{};baidu.dom.g=function(id){if(!id){return null}if("string"==typeof id||id instanceof String){return document.getElementById(id)}else{if(id.nodeName&&(id.nodeType==1||id.nodeType==9)){return id}}return null};baidu.g=baidu.G=baidu.dom.g;baidu.browser=baidu.browser||{};baidu.browser.opera=/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp["\x246"]||RegExp["\x242"]):undefined;baidu.dom.insertHTML=function(element,position,html){element=baidu.dom.g(element);var range,begin;if(element.insertAdjacentHTML&&!baidu.browser.opera){element.insertAdjacentHTML(position,html)}else{range=element.ownerDocument.createRange();position=position.toUpperCase();if(position=="AFTERBEGIN"||position=="BEFOREEND"){range.selectNodeContents(element);range.collapse(position=="AFTERBEGIN")}else{begin=position=="BEFOREBEGIN";range[begin?"setStartBefore":"setEndAfter"](element);range.collapse(begin)}range.insertNode(range.createContextualFragment(html))}return element};baidu.insertHTML=baidu.dom.insertHTML;baidu.page=baidu.page||{};baidu.page.getHeight=function(){var doc=document,body=doc.body,html=doc.documentElement,client=doc.compatMode=="BackCompat"?body:doc.documentElement;return Math.max(html.scrollHeight,body.scrollHeight,client.clientHeight)};baidu.sio.callByBrowser=function(url,opt_callback,opt_options){var scr=document.createElement("SCRIPT"),scriptLoaded=0,options=opt_options||{},charset=options.charset,callback=opt_callback||function(){},timeOut=options.timeOut||0,timer;scr.onload=scr.onreadystatechange=function(){if(scriptLoaded){return}var readyState=scr.readyState;if("undefined"==typeof readyState||readyState=="loaded"||readyState=="complete"){scriptLoaded=1;try{callback();clearTimeout(timer)}finally{scr.onload=scr.onreadystatechange=null;baidu.sio._removeScriptTag(scr)}}};if(timeOut){timer=setTimeout(function(){scr.onload=scr.onreadystatechange=null;baidu.sio._removeScriptTag(scr);options.onfailure&&options.onfailure()},timeOut)}baidu.sio._createScriptTag(scr,url,charset)};baidu.event=baidu.event||{};baidu.event._listeners=baidu.event._listeners||[];baidu.dom._g=function(id){if(baidu.lang.isString(id)){return document.getElementById(id)}return id};baidu._g=baidu.dom._g;baidu.event.on=function(element,type,listener){type=type.replace(/^on/i,"");element=baidu.dom._g(element);var realListener=function(ev){listener.call(element,ev)},lis=baidu.event._listeners,filter=baidu.event._eventFilter,afterFilter,realType=type;type=type.toLowerCase();if(filter&&filter[type]){afterFilter=filter[type](element,type,realListener);realType=afterFilter.type;realListener=afterFilter.listener}if(element.addEventListener){element.addEventListener(realType,realListener,false)}else{if(element.attachEvent){element.attachEvent("on"+realType,realListener)}}lis[lis.length]=[element,type,listener,realListener,realType];return element};baidu.on=baidu.event.on;baidu.event.un=function(element,type,listener){element=baidu.dom._g(element);type=type.replace(/^on/i,"").toLowerCase();var lis=baidu.event._listeners,len=lis.length,isRemoveAll=!listener,item,realType,realListener;while(len--){item=lis[len];if(item[1]===type&&item[0]===element&&(isRemoveAll||item[2]===listener)){realType=item[4];realListener=item[3];if(element.removeEventListener){element.removeEventListener(realType,realListener,false)}else{if(element.detachEvent){element.detachEvent("on"+realType,realListener)}}lis.splice(len,1)}}return element};baidu.un=baidu.event.un;baidu.event.once=function(element,type,listener){element=baidu.dom._g(element);function onceListener(event){listener.call(element,event);baidu.event.un(element,type,onceListener)}baidu.event.on(element,type,onceListener);return element};baidu.object.each=function(source,iterator){var returnValue,key,item;if("function"==typeof iterator){for(key in source){if(source.hasOwnProperty(key)){item=source[key];returnValue=iterator.call(source,item,key);if(returnValue===false){break}}}}return source};baidu.url=baidu.url||{};baidu.url.escapeSymbol=function(source){return String(source).replace(/[#%&+=\/\\\ \　\f\r\n\t]/g,function(all){return"%"+(256+all.charCodeAt()).toString(16).substring(1).toUpperCase()})};baidu.url.jsonToQuery=function(json,replacer_opt){var result=[],itemLen,replacer=replacer_opt||function(value){return baidu.url.escapeSymbol(value)};baidu.object.each(json,function(item,key){if(baidu.lang.isArray(item)){itemLen=item.length;while(itemLen--){result.push(key+"="+replacer(item[itemLen],key))}}else{result.push(key+"="+replacer(item,key))}});return result.join("&")};baidu.url.queryToJson=function(url){var query=url.substr(url.lastIndexOf("?")+1),params=query.split("&"),len=params.length,result={},i=0,key,value,item,param;for(;i<len;i++){if(!params[i]){continue}param=params[i].split("=");key=param[0];value=param[1];item=result[key];if("undefined"==typeof item){result[key]=value}else{if(baidu.lang.isArray(item)){item.push(value)}else{result[key]=[item,value]}}}return result};window.arrBaiduAds=window.arrBaiduAds||[];var BAPPQueue=[];function _getSwf(movieName){if(window.document[movieName]){return window.document[movieName]}if(!window.attachEvent){if(document.embeds&&document.embeds[movieName]){return document.embeds[movieName]}}else{return baidu.g(movieName)}}function _format(t,d){var t=t;for(var i in d){t=t.replace("#{"+i+"}",d[i]||"")}return t}function renderLoader(flag,pos,customHeight){return['<div class="bd-app-mask" id="BAPPMask',flag,'" style="display:none;',customHeight?"height:"+customHeight+"px;":"",'">','<div class="bd-app-mask-inner">','<p class="bd-app-loading-ico"><img src="//bs.baidu.com/adtest/',pos?'b04c5dcbb67404a970858747f1af6ffe':'4fd7b8a9c56a730990f75da5747b564e','.gif"/></p>','<p class="bd-app-loading-stats"><span id="BAPPSorry',flag,'"></span><span class="bd-app-name" id="BAPPAppName',flag,'"></span><span id="BAPPLoadingStats',flag,'">\u6B63\u5728\u52AA\u529B\u4E3A\u60A8\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u4F5C\u7B49\u5F85\u2026</span></p>',"</div>","</div>"].join("")}function renderDeveloper(info){var _name=info.developer_name.match(/\uff1a|:/g)?[info.developer_name.split(/\uff1a|:/g)[0],info.developer_name.split(/\uff1a|:/g)[1]]:["\u5F00\u53D1\u8005",info.developer_name];baidu.g("BAPPDeveloper"+info.id).innerHTML=['<a href="http://app.baidu.com/appweb" target="_blank" style="float:right;">\u6765\u81EA\u767E\u5EA6\u5E94\u7528</a>',baidu.encodeHTML(_name[0]),'\uFF1A<a target="_blank" href="',baidu.encodeHTML(info.developer_website),'" title="',baidu.encodeHTML(_name[1]),'">',baidu.encodeHTML(_name[1]),"</a>"].join("");baidu.show("BAPPDeveloper"+info.id)}function _cf(obj,cwidth,ex){var purl="http://app.baidu.com/static/appstore/APPProxy.swf";var _width=obj.width;var _height=obj.height;var _ex=ex?"&"+ex:"";if(obj.app_type%11==1){if(cwidth<540||cwidth>800){_width="100%";window.BAPPRestHeight=window.BAPPRestHeight||0;_height=baidu.page.getHeight()-BAPPRestHeight}else{if(cwidth<obj.width){_height=parseInt(_height*cwidth/_width);_width=cwidth}}}with(obj){return['<div id="BAPPAppProxy',id,'" style="position:absolute;width:1px;height:1px;z-index:1000;">','<object align="middle" height="1" width="1" id="BAPPProxy',id,'" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000">','<param value="#FFFFFF" name="bgcolor">','<param name="allowScriptAccess" value="always">','<param value="',purl,'" name="movie"><param value="lcName=',stamp,"&messageHandler=BAPP.run('",flag,"','",id,"')&logHandler=logHandler&token=",bdstoken,"&appID=",app_id,'" name="flashvars">','<embed allowScriptAccess="always"  align="middle" height="1" width="1" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" name="BAPPProxy',id,'" src="',purl,'" flashvars="lcName=',stamp,"&messageHandler=BAPP.run('",flag,"','",id,"')&logHandler=logHandler&token=",bdstoken,"&appID=",app_id,'" bgcolor="#FFFFFF" errormessage="请下载最新的Flash播放器！" ver="9.0.28">',"</object></div>",'<div id="BAPPAppSandbox',id,'" class="bd-app-fix-init-bug">','<object align="middle" height="',_height,'" width="',_width,'" id="BAPPFlash',id,'" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000">','<param value="',src,'" name="movie">','<param value="lcName=',stamp,_ex,'" name="flashvars">','<param value="'+(baidu.browser.ie?"window":"opaque")+'" name="wmode">','<embed align="middle" height="',_height,'" width="',_width,'" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" name="BAPPFlash',id,'" src="',src,'" flashvars="lcName=',stamp,_ex,'" wmode="'+(baidu.browser.ie?"":"opaque")+'" errormessage="\u8BF7\u4E0B\u8F7D\u6700\u65B0\u7684Flash\u64AD\u653E\u5668\uFF01" ver="9.0.28">',"</object></div>",'<div style="display:none;" id="BAPPDeveloper'+id+'" class="bd-app-developer" style="width:',_width,'px">#dd#',"</div>"].join("")}}function _ci(obj,hash,_ex){var _src=(obj.src.indexOf("?")==-1?obj.src+"?"+_ex:obj.src+(_ex?"&"+_ex:""));_src=_src.replace(/[&]+/g,"&").replace(/[^\x00-\xff\s]+/g,function(notAscii){return encodeURIComponent(notAscii)});with(obj){return['<div id="BAPPAppSandbox',id,'" class="bd-app-fix-init-bug">','<iframe id="BAPPIframeCanvas',id,'" frameborder="0" width="100%" scrolling="no" style="background-color: transparent; height: ',height,'px;" allowtransparency="true" src="',_src,'" name="BAPPIframeCanvas',id,'"></iframe></div>','<div style="display:none;" id="BAPPDeveloper'+id+'" class="bd-app-developer" style="width:100%">#dd#',"</div>"].join("")}}function _getF(f){try{return f.CurrentFrame()>=0}catch(e){return 0}}function _getP(f){try{return f.PercentLoaded()}catch(e){return 0}}function _jtq(json){var str=[];for(var i in json){str.push(i+"="+encodeURIComponent(json[i]))}return str.join("&")}function _yc(id){baidu.sio.callByBrowser("http://wa.hm.baidu.com/a.js?"+id)}function _ycleave(id){window["_hm_webapp_"+id]&&window["_hm_webapp_"+id].sendDuration(id)}function BAPPLoader(bappapp,id,parNode){this.par=bappapp;this.id=id;this.loader=baidu.q("bd-app-mask",parNode)[0];this.name=baidu.q("bd-app-name",parNode)[0]}BAPPLoader.prototype={show:function(){try{baidu.g("BAPPAppName"+this.id).innerHTML=this.par.appinfo.app_name}catch(e){}baidu.show(this.loader||baidu.g("BAPPMask"+this.id))},hide:function(){baidu.hide(this.loader||baidu.g("BAPPMask"+this.id))},reRend:function(){baidu.g("BAPPSorry"+this.par.id).innerHTML="";baidu.g("BAPPLoadingStats"+this.par.id).innerHTML="\u6B63\u5728\u52AA\u529B\u4E3A\u60A8\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u4F5C\u7B49\u5F85\u2026"}};function BAPPIframe(bappapp){this.par=bappapp;this.id=this.par.appinfo.id;this.init()}BAPPIframe.prototype={init:function(){var _this=this;this.iframe=baidu.g("BAPPIframeCanvas"+this.id);this.iframeWindow=frames["BAPPIframeCanvas"+this.id];this.iframeWindow.name="bd@bAPPFlag="+this.par.par.flag+"&appFlag="+this.par.id+"&relay="+encodeURIComponent(this.par.par.relay)+"@bd";function handle(){_this.par.onloaded();_this.iframe.attachEvent&&_this.iframe.detachEvent("onload",handle);if(_this.par.failed){return}if(_this.__loaded__){return}_this.__loaded__=1}if(this.iframe.attachEvent){this.iframe.attachEvent("onload",handle)}else{this.iframe.onload=function(){handle();_this.iframe.onload=null}}},reload:function(){try{this.par.clearTimer();this.par.loader.reRend();this.iframe.src=this.iframe.src;this.par.setTimer()}catch(e){}},reveiveMessage:function(opts){},sound:function(){this.sendMessage({mess:"bd_adv_finish"})},mute:function(){this.sendMessage({mess:"bd_app_mute"})},setHeight:function(height){this.iframe.style.height=parseInt(height)+"px"}};if(window.postMessage){BAPPIframe.prototype.sendMessage=function(mess){var mess=mess||{};this.iframeWindow.postMessage(baidu.url.jsonToQuery(baidu.object.extend({bAPPFlag:this.par.par.flag,appFlag:this.id},mess)),"*")}}else{BAPPIframe.prototype.sendMessage=function(mess){var mess=baidu.url.jsonToQuery(baidu.object.extend({bAPPFlag:this.par.par.flag,appFlag:this.id,relay:encodeURIComponent(this.par.par.relay)},mess));var src=this.iframe.src.split("#");var hash=src[1]?"#"+src[1]+"&"+mess:"#"+mess;hash=src[1]?src[1]+"&"+mess:mess;hash+="&stamp="+(+(new Date()));this.iframeWindow.name="bd@"+hash+"@bd"}}BAPPFlashWrapper=function(id){this.id=id;this.loaded=false;this.onload=[]};BAPPFlashWrapper.prototype={wait:function(callback){callback&&this.onload.push(callback);if(this.loaded){for(var i=0;i<this.onload.length;i++){this.onload[i]&&this.onload[i]()}this.onload=[]}else{this.proxy=_getSwf("BAPPProxy"+this.id);this.swf=_getSwf("BAPPFlash"+this.id);this.loaded=_getF(this.proxy)&&_getF(this.swf)&&this.proxy.sendMessage;var now=this;clearTimeout(this.timer);this.timer=setTimeout(function(){now.wait()},112*5)}},sendMessage:function(command,arg){var _this=this;this.wait(function(){_this.proxy=_getSwf("BAPPProxy"+_this.id);try{_this.proxy.sendMessage(command,arg)}catch(e){}})}};function BAPPFlashAdpter(bappapp){this.par=bappapp;this.id=this.par.appinfo.id;this.loaded=0}BAPPFlashAdpter.prototype={init:function(flag){flag&&this.appProxy&&clearTimeout(this.appProxy.timer);this.appFlash=_getSwf("BAPPFlash"+this.id);this.appProxy=new BAPPFlashWrapper(this.id);if(flag){this.par.onloaded(1);return}this.getProgress()},destroy:function(){this.appProxy.timer&&clearTimeout(this.appProxy.timer);this.destroyed=true},mute:function(){this.appProxy.sendMessage("APP.Utils.setMute",[true])},sound:function(){this.appProxy.sendMessage("APP.Utils.setMute",[false])},submitScoreOk:function(msgId){this.appProxy.proxy&&this.appProxy.proxy.replyMessage(msgId,{data:[true]})},reload:function(){try{var lcName="lcName="+(+(new Date()));var dh=baidu.g("BAPPDeveloper"+this.id).innerHTML;baidu.g("BAPPAppContainer"+this.id).innerHTML=this.par.html.replace(/lcName=[0-9]+/g,lcName).replace("#dd#",dh);(getSkin()==3)&&baidu.show("BAPPDeveloper"+this.id);this.init(1)}catch(e){}},msgHandler:function(msg,obj){if(!msg){return}var msg=msg[0];var apiName=msg.apiName;switch(apiName){case"APP.Game.submitScore":BAPPScore.show(msg.args[0],msg.args[1]||"",msg.__id__,"bAPPFlag="+obj.par.par.flag+"&appFlag="+obj.id+"&app_id="+obj.par.appinfo.app_id+"&bdstoken="+obj.par.appinfo.bdstoken+"&T="+obj.par.appinfo.T+"&ck="+obj.par.appinfo.ck,obj.par.appinfo);break}},logHandler:function(mess){},onload:function(callback){var _this=this;if(this.loaded){callback&&callback()}else{if(this.destroyed){return}setTimeout(function(){_this.onload(callback)},500)}},getProgress:function(callback){var _this=this;if(this.destroyed){return}if(_getF(this.appFlash)&&!this.par.loaded){this.loaded=1;this.par.onloaded();if(this.par.failed){return}this.appFlashFirstFrameLt=+(new Date())-this.par.startTime;this.par.BAPPQueuePush({tm:this.appFlashFirstFrameLt,fm:"apptm",infoCost:this.par.infoCost,item:"app-flash-first-lt"})}var percent=_getP(this.appFlash);callback&&callback(percent);if(this.par.failed){return}if(percent>=100){if(this.par.failed||this.com){return}this.com=1;this.appFlashCompleteFrameLt=+(new Date())-this.par.startTime;this.par.BAPPQueuePush({tm:this.appFlashCompleteFrameLt,fm:"apptm",item:"app-flash-complete-lt"});this.par.BAPPQueuePush({tm1:this.appFlashFirstFrameLt,tm2:this.appFlashCompleteFrameLt,infoCost:this.par.infoCost,fm:"apptm",item:"flash-stats"})}if(this.par.loaded&&this.com){return}setTimeout(function(){_this.getProgress(callback)},112)}};var StatsMgr={send:function(opts,flag,sendHis){var n="log_"+(new Date()).getTime();var c=window[n]=new Image();c.onload=(c.onerror=function(){window[n]=null});if(sendHis){c.src=opts+"&version=2&t="+(+new Date())}else{delete opts.method;var query=[];opts.version=2;for(var i in opts){query.push(i+"="+opts[i])}query=query.join("&");if(flag=="pv"){var url="http://app.baidu.com/app/pv_count?"}else{if(flag){var url="http://nsclick.baidu.com/v.gif?"}else{var url="http://nsclick.baidu.com/v.gif?";var n2="log_"+(new Date()).getTime();var c2=window[n2]=new Image();c2.onload=(c2.onerror=function(){window[n2]=null});c2.src=url+"pid=201&tid=7000&pj=app&"+query+"&t="+(+new Date());c2=null;url="http://app.baidu.com/static/appstore/images/w.gif?"}}c.src=url+"pid=201&tid=7000&pj=app&"+query+"&t="+(+new Date())}c=null}};function getSkin(){if(window.BAPPCustomSkin){return window.BAPPCustomSkin}if(document.location.href.match(/http\:\/\/www\.baidu\.com\/$/g)||!document.location.href.match("baidu.com")){return 2}else{if(document.location.href.match(".baidu.com")){return 1}else{return 3}}}function BAPPApp(app_id,bapp,customHeight){this.startTime=+(new Date());this.loop=0;this.app_id=app_id;this.par=bapp;this.customHeight=customHeight||380;this.type="app";this.par.dispatchEvent("appStart",{app_id:app_id});if(!customHeight){this.par.dispatchEvent("setHeight",{app_id:app_id,height:this.customHeight||380})}var id=[app_id,this.startTime,parseInt(Math.random()*100)].join("");var _this=this;this.id=id;this.app_spce_id=this.par.width<800?1:(this.par.width==800?3:2);var loader=document.createElement("div");loader.className="bd-app-container bd-app-hide-ele "+(this.par.autoWidth?"":"bd-app-width-"+this.par.width);loader.id="BAPPAppContainer"+id;loader.innerHTML=renderLoader(id,this.par.width>540,this.customHeight);this.customHeight&&(loader.style.height=this.customHeight+"px");baidu.g(this.par.container).appendChild(loader);this.loader=new BAPPLoader(this,id,loader);this.loader.show();this.timer=[];this.setTimer();this.extraInfo=""}BAPPApp.prototype={load:function(t){if(baidu.lang.isObject(t)){if(t.isOpen){this.isOpen=1}t.zone&&(delete t.zone);this.extraInfo=_jtq(t)}this.loop++;this.freshTime=+(new Date());this.setTimer();baidu.sio.callByServer("http://app.baidu.com/appweb/api/"+(this.par.zone=="web-list"||this.par.more?"render/search":"appinfo")+"?appid="+this.app_id+"&apikey="+this.par.apikey+"&t="+this.freshTime+"&app_spce_id="+this.app_spce_id,"BAPP."+this.par.flag+".render",{charset:"utf-8"})},renderAPP:function(info,t){if(baidu.lang.isObject(t)){if(t.isOpen){this.isOpen=1}t.zone&&(delete t.zone);this.extraInfo=_jtq(t)}else{if(t&&t!=this.freshTime){return}}this.infoCost=+(new Date())-this.startTime;this.appinfo=info;this.loader.show();this.appinfo.id=this.id;this.appinfo.stamp=this.appinfo.app_id+Math.random();this.appinfo.flag=this.par.flag;this.adv={ended:1};this.html="";var injectArg=this.extraInfo.match(/(^(s_|bd_|canvas_)[^&]+)|(&(s_|bd_|canvas_)[^&]+)|(^(keyword=[^&]+))|(&keyword=[^&]+)/g);if(this.appinfo.app_type%11==1){this.html+=_cf(this.appinfo,this.par.width,(injectArg||[]).join("&"));this.type="flash";this.appObject="BAPPFlash"+this.id}else{this.html+=_ci(this.appinfo,"bAPPFlag="+this.par.flag+"&appFlag="+this.appinfo.id+"&relay="+encodeURIComponent(this.par.relay),(injectArg||[]).join("&"));this.type="iframe";this.appObject="BAPPIframeCanvas"+this.id}baidu.dom.insertHTML("BAPPAppContainer"+this.appinfo.id,"beforeend",this.html);this.skin=getSkin();if(this.skin==2){renderDeveloper(this.appinfo)}if(this.appinfo.app_type%11==1){this.app=new BAPPFlashAdpter(this);this.app.init()}else{this.app=new BAPPIframe(this)}this.par[this.appinfo.id]=this.app},show:function(){this.loader.hide();this.par.dispatchEvent("appShow",this.appinfo);if(this.type=="flash"){baidu.removeClass("BAPPAppSandbox"+this.appinfo.id,"bd-app-fix-init-bug")}else{baidu.removeClass("BAPPAppContainer"+this.appinfo.id,"bd-app-hide-ele")}baidu.removeClass("BAPPAppContainer"+this.appinfo.id,"bd-app-hide-app");var height=parseInt(baidu.g(this.appObject).style&&baidu.g(this.appObject).style.height?parseInt(baidu.g(this.appObject).style.height):baidu.g(this.appObject).height)+baidu.g("BAPPDeveloper"+this.id).scrollHeight;this.par.resizeLoader(height);this.par.dispatchEvent("setHeight",{app_id:this.app_id,app_name:this.appinfo.app_name,height:height});this.app.sound()},onloaded:function(arg){this.tloaded=+(new Date());var _this=this;if(arg){this.show()}if(baidu.g(this.appObject)){var __click__=1;if(this.isOpen&&!arg){__click__=0}baidu.event.once(baidu.g(this.appObject),"mouseover",function(){if(__click__!=1){__click__=+(new Date())}this.onmouseout=function(){if(__click__>1&&(+(new Date())-__click__>5000)){__click__=1;_this.par.dispatchEvent("stats",baidu.object.extend({method:"sclick",rsv:"simulated"},_this.appinfo))}_this.BAPPQueuePush([{fm:"appua",item:"mouseout"},"v.gif"]);clearTimeout(_this.userStayTimer);_this.userStayTimer=setTimeout(function(){_ycleave(_this.appinfo.app_id);_yc(_this.appinfo.app_id)},1000*60*60)};this.onmouseover=function(){if(__click__!=1){__click__+(new Date())}_this.BAPPQueuePush([{fm:"appua",item:"mousein"},"v.gif"]);clearTimeout(_this.userStayTimer)};_this.BAPPQueuePush([arg?{fm:"appua",item:"mousein"}:{fm:"appua",item:"mousein",firstmi:1},"v.gif"])})}var t=+(new Date());if(this.loaded){return}this.clearTimer();var tm=t-this.startTime;this.par.dispatchEvent("appLoaded",baidu.object.extend({tm:tm},this.appinfo));this.adv.ended&&this.show();_yc(this.appinfo.app_id);if(this.failed){return}this.loaded=1;this.BAPPQueuePush([{item:"pageload",fm:"apppv"},"v.gif"]);if(this.type=="iframe"){this.BAPPQueuePush({fm:"apptm",item:"app-iframe-lt",infoCost:this.infoCost,tm:tm});_this.timer.push(setTimeout(function(){_this.BAPPQueuePush({fm:"apptm",item:"app-iframe-satisfaction",infoCost:_this.infoCost})},1000))}if(BAPP.pk_js_ok||!this.appinfo.is_pk){return}baidu.sio.callByBrowser("http://app.baidu.com/static/appstore/for_app_pk_v2.js?v=1.19",0,{charset:"utf-8"});BAPP.pk_js_ok=1},onFailed:function(){this.clearTimer();if(this.loaded||!baidu.g("BAPPSorry"+this.id)){return}var t=+(new Date());this.par.dispatchEvent("appFailed",this.appinfo||{app_id:this.app_id});this.failed=1;baidu.g("BAPPSorry"+this.id).innerHTML="\u62B1\u6B49\uFF0C";baidu.g("BAPPLoadingStats"+this.id).innerHTML='\u52A0\u8F7D\u5931\u8D25\u4E86\uFF0C\u8BF7\u60A8<a href="#" onclick="BAPP.reload(\''+this.par.flag+"','"+this.id+"',"+this.app_id+');return false">\u5237\u65B0</a>\u540E\u518D\u8BD5\u2026';this.BAPPQueuePush({item:this.type+"-server-lost",fm:"apptm",tm:t-this.startTime})},onLong:function(){if(this.loaded||!baidu.g("BAPPLoadingStats"+this.id)){return}baidu.g("BAPPLoadingStats"+this.id).innerHTML='\u672C\u6B21\u52A0\u8F7D\u65F6\u95F4\u7A0D\u957F\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85\u6216<a href="#" onclick="BAPP.reload(\''+this.par.flag+"','"+this.id+"',"+this.app_id+');return false">\u5237\u65B0</a>\u2026'},hide:function(){this.app.mute&&this.app.mute();baidu.g("BAPPAppContainer"+this.id)&&(baidu.g("BAPPAppContainer"+this.id).style.height="1px");baidu.addClass("BAPPAppContainer"+this.id,"bd-app-hide-app")},clearTimer:function(){baidu.each(this.timer,function(item){clearTimeout(item)});this.timer=[]},setTimer:function(){var _this=this;this.clearTimer();this.timer.push(setTimeout(function(){_this.onLong()},BAPP.config.longTime));this.timer.push(setTimeout(function(){_this.onFailed()},BAPP.config.lostTime))},autoRuin:function(info){this.clearTimer();this.ruined=1;this.destroy()},destroy:function(){this.clearTimer();var t=+(new Date());this.par.dispatchEvent("appDestroyed",this.appinfo||{app_id:this.app_id});!this.ruined&&this.BAPPQueuePush({fm:"apptm",item:this.loaded?"app-stay-time":this.type+"-lt-err",tm:t-(this.loaded?this.tloaded:this.startTime)});this.appinfo&&_ycleave(this.appinfo.app_id);this.app&&this.app.destroy&&this.app.destroy();try{delete this.par[this.id];delete this.par.apps[this.app_id];baidu.g(this.par.container).removeChild(baidu.g("BAPPAppContainer"+this.id))}catch(e){}},BAPPQueuePush:function(item){if(baidu.lang.isArray(item)){item[0].appid=this.app_id;item[0].ck=this.appinfo?this.appinfo.ck:"getInfoFailed";item[0].T=this.appinfo?this.appinfo.T:"getInfoFailed";this.par.zone&&(item[0].zone=this.par.zone);this.par.apikey&&(item[0].apikey=this.par.apikey);if(this.extraInfo){item[0].T=item[0].T+"&"+this.extraInfo}}else{if(baidu.lang.isObject(item)){item.appid=this.app_id;item.ck=this.appinfo?this.appinfo.ck:"getInfoFailed";item.T=this.appinfo?this.appinfo.T:"getInfoFailed";this.par.zone&&(item.zone=this.par.zone);this.par.apikey&&(item.apikey=this.par.apikey);if(this.extraInfo){item.T=item.T+"&"+this.extraInfo}}}BAPPQueue.push(item)}};window.BAPP=window.BAPP||function(config){baidu.object.extend(this,config);if((this.zone||"").indexOf("list")==-1){this.zone="bdother"}this.width=this.width||540;this.flag="BAPPClass"+(+(new Date()))+parseInt(Math.random()*100);BAPP[this.flag]=this;var _this=this;if(this.destructor&&!baidu.lang.isFunction(this.destructor)){this.destructor=function(){for(var i in _this.apps){_this.apps[i].hide&&_this.apps[i].hide()}}}else{if(!this.destructor){this.destructor=function(){for(var i in _this.apps){_this.apps[i].destroy&&_this.apps[i].destroy()}}}}if(this.openEffect){_this.addEventListener("setHeight",function(e,o){_this.heightEffect(o.height)})}this.apps={};(function(obj){var _this=obj;var __flag__=0;if(!document.all){baidu.on(window,"beforeunload",function(){__flag__=1;for(var i in _this.apps){_this.apps[i].destroy&&_this.apps[i].destroy()}})}baidu.on(window,"unload",function(){if(__flag__){return}for(var i in _this.apps){_this.apps[i].destroy&&_this.apps[i].destroy()}})})(this)};BAPP.config={lostTime:20*1000,longTime:15*1000,appHeight:380};BAPP.reload=function(flag,id,app_id){if(BAPP[flag]){try{BAPP[flag][id].reload()}catch(e){if(BAPP[flag].apps&&BAPP[flag].apps[app_id]){BAPP[flag].apps[app_id].loader.reRend();BAPP[flag].apps[app_id].load()}}}};BAPP.receive=function(opts){if(BAPP[opts.bAPPFlag]&&BAPP[opts.bAPPFlag][opts.appFlag]){var bApp=BAPP[opts.bAPPFlag];var appItem=BAPP[opts.bAPPFlag][opts.appFlag];var method={resize:function(o){appItem.setHeight(o.height);o.height=parseInt(o.height)+baidu.g("BAPPDeveloper"+appItem.par.id).scrollHeight;appItem.par.loaded&&appItem.par.adv.ended&&(baidu.g("BAPPAppContainer"+appItem.par.id).style.height=o.height+"px");appItem.par.loaded&&appItem.par.adv.ended&&bApp.dispatchEvent("setHeight",o)},submitScoreOk:function(o){appItem.submitScoreOk&&appItem.submitScoreOk(o.msgId);bApp.dispatchEvent("submitScoreOk",o)},submitScoreFailed:function(o){bApp.dispatchEvent("submitScoreFailed",o)},suspend:function(o){},states:function(o){return;if(o.domready){if(appItem.statsSended){return}appItem.statsSended=1;o.item="iframe-stats";o.settime=appItem.par.startTime;o.fm="apppv"}if(o.click){o.item="click";o.fm="appua"}appItem.par.BAPPQueuePush(o)},loaded:function(o){if(o&&(o.type=="flash")){if(o.flash*1>0){return}}appItem.par.onloaded()},checkUser:function(o){bApp.dispatchEvent("checkUser",o)},score:function(o){try{if(o.errno){bApp.dispatchEvent("submitScoreFailed",o)}else{bApp.dispatchEvent("submitScoreOk",o);appItem.submitScoreOk("e",o.msgId)}}catch(e){}},stats:function(o){if(o.domready){if(appItem.statsSended==2){return}else{if(appItem.statsSended){o.item="iframe-jump";appItem.statsSended=2}else{o.item="iframe-stats";appItem.statsSended=1}}o.settime=appItem.par.startTime;o.fm="apppv"}if(o.click){o.item="click";o.fm="appua"}if(o.force){o.item="app-loading";o.fm="apppv"}appItem.par.BAPPQueuePush(o)},debug:function(o){bApp.dispatchEvent("debug",o)}};opts.app_id=appItem.par.app_id;appItem.par.appinfo&&(opts.app_name=appItem.par.appinfo.app_name);method[opts.method]&&method[opts.method](opts)}};baidu.on(window,"message",function(e){BAPP.receive(baidu.url.queryToJson(e.data))});BAPP.run=function(flag,id){if(BAPP[flag]){return function(){BAPP[flag][id].msgHandler.call(BAPP[flag][id],arguments,BAPP[flag][id])}}return function(){}};BAPP.prototype={setCache:function(cache,key){if(!this.cache[key]){this.length++;if(this.length>9){for(var i in this.cache){delete this.cache[i];this.length--;if(this.length<10){break}}}}this.cache[key]=cache},render:function(info,t,customHeight){var id=baidu.lang.isObject(info)?info.app_id:info;if(!baidu.lang.isNumber(t)){StatsMgr.send({appid:id,zone:this.zone,apikey:this.apikey||0},"pv")}if(t&&(+(new Date())-t>BAPP.config.lostTime)){return}(!t||baidu.lang.isObject(t))&&this.destructor&&this.destructor(this.apps);if(this.apps[id]&&this.apps[id].appinfo){this.apps[id].show()}else{if((this.zone=="web-list"||this.more==1)&&baidu.lang.isObject(info)&&((!info.is_app_free&&!info.is_paid)||(info.errno>=1000)&&(info.errno<1004))){this.apps[id]&&this.apps[id].autoRuin();this.dispatchEvent("appLoaded",info);return}else{if(baidu.lang.isObject(info)&&info.src){if(this.apps[id]&&!this.apps[id].appinfo){this.apps[id].renderAPP(info,t)}else{if(!parseInt(t)){this.apps[id]=new BAPPApp(id,this,customHeight);this.apps[id].renderAPP(info,t)}}}else{if((baidu.lang.isObject(info)&&info.app_id)||(info*1>0)){if(this.apps[id]){if(this.apps[id].loop>3){(!this.apps[id].failed)&&this.apps[id].onFailed();return}}else{this.apps[id]=new BAPPApp(id,this,customHeight);if(baidu.lang.isObject(t)&&t.hold){delete t.hold;return}}this.apps[id].load(t)}}}}},updateApp:function(info,t){if(!info.is_app_free&&!info.is_paid){this.apps[info.app_id]&&this.apps[info.app_id].autoRuin(info)}else{this.apps[info.app_id]&&this.apps[info.app_id].renderAPP(info,t)}},resizeLoader:function(height){baidu.each(baidu.q("bd-app-mask",this.container),function(item){item.style.height=height+"px"});baidu.each(baidu.q("bd-app-container",this.container),function(item){item.style.height=height+"px"})},show:function(id){this.apps[id]&&this.apps[id].show()},destroy:function(id){if(id){this.apps[id]&&this.apps[id].destroy&&this.apps[id].destroy()}else{for(var i in this.apps){this.apps[i].destroy&&this.apps[i].destroy()}}}};if(baidu.browser.ie<9||baidu.browser.firefox<4){BAPP.prototype.heightEffect=function(height){clearInterval(this.effectTimer);var c=baidu.g(this.container);if(!c){return}var _this=this;if(height>(parseInt(c.style.height)||c.clientHeight)){this.effectTimer=setInterval(function(){try{if(c&&c.style&&(Math.ceil((parseInt(c.style.height)||c.clientHeight)*1.1)<height)){c.style.height=Math.ceil((parseInt(c.style.height)||c.clientHeight)*1.1)+"px";return}c.style.height=height+"px";clearInterval(_this.effectTimer)}catch(e){clearInterval(_this.effectTimer);c.style.height=height+"px"}},32)}else{if(height<(parseInt(c.style.height)||c.clientHeight)){this.effectTimer=setInterval(function(){try{if(c&&c.style&&(Math.ceil((parseInt(c.style.height)||c.clientHeight)*0.9)>height)){c.style.height=Math.ceil((parseInt(c.style.height)||c.clientHeight)*0.9)+"px";return}c.style.height=height+"px";clearInterval(_this.effectTimer)}catch(e){clearInterval(_this.effectTimer);c.style.height=height+"px"}},32)}}}}else{BAPP.prototype.heightEffect=function(height){if(!baidu.g(this.container)){return}if(!baidu.dom.hasClass(this.container,"bd-app-height-effect")){baidu.dom.addClass(this.container,"bd-app-height-effect")}baidu.g(this.container).style.height=height+"px"}}baidu.object.extend(BAPP.prototype,baidu.lang.Class.prototype);(function(){var _queue=BAPPQueue;BAPPQueue={push:function(arr){arr=[].concat(arr);StatsMgr.send(arr[0],arr[1])}};for(var i=0,len=_queue.length;i<len;i++){var data=[].concat(_queue[i]);StatsMgr.send(data[0],data[1])}})()})();