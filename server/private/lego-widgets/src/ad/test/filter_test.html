<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Filter Test</title>
    <script src="../../base.js"></script>
    <script src="../../../assets/js/tangram-base-1.3.7.1.js"></script>
    <script>
        goog.require('ad.Debug');
        goog.require('third_party.qunit.Qunit');
        goog.require("ad.plugin.AkaFilter");
        goog.require("ad.plugin.DefensorFilter");
        goog.require("ad.plugin.FilterRunner");
        goog.require("ad.plugin.PickValueFilter");
    </script>
</head>
<body>
<div id="qunit"></div>
<div id="error"></div>
<div id="error-validateText"></div>
<script>
function main() {
    test('ad.plugin.AkaFilter', function() {
        var spec = [{"name":"0","displayName":"播放器模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"img_url","displayName":"首帧图片","tip":"视频首帧图片","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","width":220,"height":164,"maxSize":30,"ext":"jpg,jpeg"}},{"name":"video_url","displayName":"视频文件","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"FLV","width":220,"height":164,"maxSize":700,"ext":"flv"}},{"name":"rcv_url","displayName":"视频跳转地址","datatype":"STRING","descriptionTip":"视频点击跳转地址","rules":{"required":true,"maxByteLength":255,"stringType":"URL"}},{"name":"ipad_img","displayName":"ipad显示图片","datatype":"UPLOAD","extraAttr":{"fileType":"IMAGE","maxSize":30,"ext":"jpg,jpeg"},"multiline":false},{"name":"player_ver","displayName":"播放器版本","defaultValue":"5","datatype":"HIDDEN","extraAttr":{"filters":"int"}},{"name":"width","displayName":"视频宽度","defaultValue":"220","datatype":"HIDDEN","extraAttr":{"filters":"int"}},{"name":"height","displayName":"视频高度","defaultValue":"190","datatype":"HIDDEN","extraAttr":{"filters":"int"}},{"name":"is_play","displayName":"是否自动播放","defaultValue":"false","datatype":"HIDDEN","extraAttr":{"filters":"bool"}}]},{"name":"1","displayName":"头部模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"titletext","displayName":"标题","defaultValue":"","tip":"<em>标题</em>为5~10个汉字","datatype":"HTML","nameTip":"(核心飘红词最多6个汉字)","rules":{"required":true,"minTextByteLength":10,"maxTextByteLength":20,"tagList":{"em":{"maxTextByteLength":12,"minCount":1,"maxCount":1}}},"extraAttr":{"editorConfig":{"tools":["emphasize"]},"tagList":{"em":{"isAllowNoContent":false,"isSimpleTag":false}}},"multiline":false},{"name":"titleurl_rcv_url","displayName":"跳转地址","defaultValue":"http://","tip":"","datatype":"STRING","rules":{"required":true,"stringType":"URL"},"multiline":false},{"name":"description","displayName":"描述","defaultValue":"","tip":"描述为45~60个汉字，<a href=\"http://fake.com\">链接词</a>最多5个，每个链接词最多6个汉字","datatype":"HTML","nameTip":"","descriptionTip":"","rules":{"required":true,"minTextByteLength":90,"maxTextByteLength":120,"tagList":{"a":{"maxTextByteLength":12,"maxCount":5}}},"extraAttr":{"editorConfig":{"tools":["link"]},"tagList":{"a":{"attributeRules":{"target":{"isRequired":false,"isAllowNoValue":false,"defaultValue":"_blank"},"href":{"isRequired":true,"isAllowNoValue":false,"valueType":"url"}},"requiredAttributes":["target","href"],"isAllowNoContent":false,"isSimpleTag":false}}},"multiline":true,"display":""},{"name":"site","displayName":"官网地址","defaultValue":"","tip":"最多可填写24字节","datatype":"STRING","rules":{"required":true,"maxByteLength":24},"multiline":false},{"name":"logoimg","displayName":"LOGO","datatype":"OBJECT","rules":{},"items":[{"name":"logoimg","displayName":"LOGO图片(可选)","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{},"extraAttr":{"fileType":"IMAGE","width":108,"height":14,"maxSize":5,"ext":"jpg"}},{"name":"logourl_rcv_url","displayName":"LOGO跳转地址(可选)","defaultValue":"","tip":"","datatype":"STRING","rules":{"stringType":"URL"},"multiline":false}]}]},{"name":"2","displayName":"微博模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"id","displayName":"微博个人资料页地址(或微博ID)","defaultValue":"","datatype":"STRING","descriptionTip":"sina微博个人资料页地址，如：\"http://*.weibo.com/2525235360/info?from=profile&wvr=5&loc=tabinf#profile_tab\"，或其中的“2525235360”微博ID","rules":{"required":true},"multiline":false},{"name":"name","displayName":"微博名称(可选)","defaultValue":"","datatype":"STRING","descriptionTip":"此项可不填，如不填则自动根据微博ID获取微博名称","rules":{},"multiline":false},{"name":"icon","displayName":"微博图标(可选)","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{},"extraAttr":{"fileType":"IMAGE","width":18,"height":18,"maxSize":25,"ext":"jpg,gif,png"},"multiline":false},{"name":"icon_url","displayName":"微博图标跳转地址(可选)","defaultValue":"","tip":"http://","datatype":"STRING","rules":{"stringType":"URL"},"multiline":false},{"name":"verify_img","displayName":"认证图标","defaultValue":"","tip":"","datatype":"HIDDEN","rules":{},"extraAttr":{"fileType":"IMAGE","width":14,"height":12,"maxSize":25,"ext":"jpg,gif,png"},"multiline":false},{"name":"follow_imgsrc","displayName":"加关注图标","defaultValue":"http://bs.baidu.com/adtest/c657a94c8803b67b903a42c7598fa63f.jpg","tip":"","datatype":"HIDDEN","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","maxSize":25,"ext":"jpg,gif,png"},"multiline":false},{"name":"weibo_logo_url","displayName":"微博LOGO跳转地址","defaultValue":"","tip":"http://","datatype":"HIDDEN","rules":{"stringType":"URL"},"multiline":false},{"name":"weibo_logo","displayName":"微博LOGO","defaultValue":"","tip":"","datatype":"HIDDEN","rules":{},"extraAttr":{"fileType":"IMAGE","maxSize":50,"ext":"jpg,gif,png"},"multiline":false},{"name":"weibo_context_length","displayName":"微博内容字节长度","defaultValue":"80","datatype":"HIDDEN","descriptionTip":"微博内容不超过160字节(1汉字=2字节)","extraAttr":{"filters":"int"},"multiline":false},{"name":"is_display_icon","displayName":"是否显示微博图标","defaultValue":"true","datatype":"HIDDEN","rules":{},"extraAttr":{"filters":"bool"}},{"name":"is_display_fans","displayName":"是否显示粉丝数","defaultValue":"true","datatype":"BOOL","rules":{}},{"name":"is_display_weibo","displayName":"是否显示微博数","defaultValue":"true","datatype":"BOOL","rules":{}},{"name":"is_display_foot","displayName":"是否显示日期、转发、收藏、评论","defaultValue":"true","datatype":"BOOL","rules":{}}]},{"name":"3","displayName":"多按钮模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"options","displayName":"链接列表","datatype":"LIST","rules":{"minCount":3,"maxCount":6},"items":[{"name":"text","displayName":"推广名","defaultValue":"官方微博","datatype":"STRING","rules":{"required":true,"maxByteLength":10}},{"name":"url","displayName":"链接","defaultValue":"http://","datatype":"STRING","rules":{"required":true,"maxByteLength":255,"stringType":"URL"}}]}]},{"name":"4","displayName":"胶带模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"disable","displayName":"不显示左右箭头","defaultValue":"false","tip":"","datatype":"HIDDEN","nameTip":"选中不显示左右箭头,取消选中显示左右箭头","rules":{},"extraAttr":{"filters":"bool"}},{"name":"image_width","displayName":"胶带图宽度","defaultValue":"127","tip":"","datatype":"HIDDEN","rules":{"stringType":"NUMBER"},"extraAttr":{"filters":"float"},"multiline":false},{"name":"image_margin","displayName":"胶带图间距","defaultValue":"5","tip":"","datatype":"HIDDEN","rules":{"stringType":"NUMBER"},"extraAttr":{"filters":"float"},"multiline":false},{"name":"speed","displayName":"胶带图片步进间隔时间(毫秒)","defaultValue":"25","datatype":"HIDDEN","rules":{"stringType":"NUMBER"},"extraAttr":{"filters":"float"},"multiline":false},{"name":"options","displayName":"图片项","tip":"图片列表","datatype":"LIST","rules":{"required":true,"minCount":5,"maxCount":10},"items":[{"name":"imgsrc","displayName":"图片地址","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","width":127,"height":135,"maxSize":10,"ext":"jpg,jpeg"}},{"name":"imgurl","displayName":"图片点击URL","defaultValue":"http://","tip":"图片点击URL","datatype":"STRING","rules":{"required":true,"maxByteLength":255,"stringType":"URL"}},{"name":"linktext","displayName":"图片描述文本","tip":"5个汉字内","datatype":"STRING","rules":{"required":true,"maxByteLength":10}}]},{"name":"left_arrow","displayName":"向左箭头图标","defaultValue":"http://bs.baidu.com/adtest/dc1e8d34e51bb836b47c73faa8484d76.png","tip":"向左箭头图标","datatype":"HIDDEN","rules":{"stringType":"URL"},"extraAttr":{},"multiline":false},{"name":"right_arrow","displayName":"向右箭头图标","defaultValue":"http://bs.baidu.com/adtest/d353670c47170fb32dd97b2dc87dbdfb.png","tip":"向右箭头图标","datatype":"HIDDEN","rules":{"stringType":"URL"},"extraAttr":{},"multiline":false}]}];
        var data = {"0":{"img_url":"http://bs.baidu.com/lego-mat/52f501cf-a757-44e1-84bd-56c9f62206d3_220_164.jpg","video_url":"http://bs.baidu.com/lego-mat/bb759ae8-fae9-4830-ba1b-cc6da5c1f0ff.flv","rcv_url":"http://v.youku.com/v_show/id_XNTY2Njg0MDgw.html?utm_source=baidu&utm_medium=brandzone&utm_term=MyDiorVideo&utm_campaign=VideoPic","ipad_img":"","player_ver":5,"width":220,"height":190,"is_play":false},"1":{"titletext":"<em>Dior</em>迪奥中国官方网站","titleurl_rcv_url":"http://www.dior.com/home/ch_cn/?utm_source=baidu&utm_medium=brandzone&utm_t…9%E4%B8%AD%E5%9B%BD%E5%AE%98%E6%96%B9%E7%BD%91%E7%AB%99&utm_campaign=Title","description":"Dior迪奥，由同名时装大师创造，半个世纪以来，不断演绎时尚魅惑，在<a target=\"_blank\" href=\"http://www.dior.com/couture/ch_cn/%E6%97%B6%E8%A3%85-%E5%8F%8A%E9%85%8D%E9%…m=brandzone&amp;utm_term=%E6%97%B6%E8%A3%85&amp;utm_campaign=Description1\">时装</a>、<a target=\"_blank\" href=\"http://www.dior.com/home/ch_cn/?utm_source=baidu&amp;utm_medium=brandzone&a…7%8F%A0%E5%AE%9D%E5%8F%8A%E6%89%8B%E8%A1%A8&amp;utm_campaign=Description2\">珠宝及手表</a>、<a target=\"_blank\" href=\"http://www.dior.cn/beauty/chn/zh/parfum/xfragrance.html?utm_source=baidu&am…m=brandzone&amp;utm_term=%E9%A6%99%E6%B0%B4&amp;utm_campaign=Description3\">香水</a>、<a target=\"_blank\" href=\"http://www.dior.cn/beauty/chn/zh/%E5%BD%A9%E5%A6%86/xmakeup.html?utm_source…m=brandzone&amp;utm_term=%E5%BD%A9%E5%A6%86&amp;utm_campaign=Description4\">彩妆</a>和<a target=\"_blank\" href=\"http://www.dior.cn/beauty/chn/zh/%E6%8A%A4%E8%82%A4/xskincare.html?utm_sour…m=brandzone&amp;utm_term=%E6%8A%A4%E8%82%A4&amp;utm_campaign=Description5\">护肤</a>领域，缔造品牌神话！","site":"Dior.com","logoimg":{"logoimg":"","logourl_rcv_url":"http://www.baidu.com"}},"2":{"id":"http://e.weibo.com/2130860695/z5aF9D63Y","name":"","icon":"","icon_url":"http://e.weibo.com/2130860695/z5aF9D63Y","verify_img":"","follow_imgsrc":"http://bs.baidu.com/adtest/c657a94c8803b67b903a42c7598fa63f.jpg","weibo_logo_url":"http://e.weibo.com/2130860695/z5aF9D63Y","weibo_logo":"","weibo_context_length":80,"is_display_icon":true,"is_display_fans":true,"is_display_weibo":true,"is_display_foot":true},"3":{"options":[{"text":"DiorMAG","url":"http://www.dior.com/magazine/ch_cn?utm_source=baidu&utm_medium=brandzone&utm_term=DiorMAG&utm_campaign=Tab1"},{"text":"新浪微博","url":"http://e.weibo.com/dior?utm_source=baidu&utm_medium=brandzone&utm_term=%E6%96%B0%E6%B5%AA%E5%BE%AE%E5%8D%9A&utm_campaign=Tab2"},{"text":"优酷主页","url":"http://u.youku.com/user_show/uid_Dior?utm_source=baidu&utm_medium=brandzone&utm_term=%E4%BC%98%E9%85%B7%E4%B8%BB%E9%A1%B5&utm_campaign=Tab4"},{"text":"iPhone应用","url":"https://itunes.apple.com/us/app/dior/id315312415?mt=8&utm_source=baidu&utm_medium=brandzone&utm_term=iPhone%E5%BA%94%E7%94%A8&utm_campaign=Tab5"},{"text":"开心主页","url":"http://www.kaixin001.com/dior?utm_source=baidu&utm_medium=brandzone&utm_term=%E5%BC%80%E5%BF%83%E4%B8%BB%E9%A1%B5&utm_campaign=Tab3"}]},"4":{"disable":false,"image_width":127,"image_margin":5,"speed":25,"options":[{"imgsrc":"http://bs.baidu.com/lego-mat/a556d19f-12cf-41b3-8d35-f7c8763d971d_127_135.jpg","imgurl":"http://www.dior.cn/beauty/chn/zh/fragrance/%E5%A5%B3%E9%A6%99/dior_addict/l…aidu&utm_medium=brandzone&utm_term=Addict%20Fragrance&utm_campaign=Rotate1","linktext":"香氛"},{"imgsrc":"http://bs.baidu.com/lego-mat/e8e54d0d-b1df-47f5-b0fd-49ea5edcda98_127_135.jpg","imgurl":"http://www.dior.com/couture/ch_cn/%E6%97%B6%E8%A3%85-%E5%8F%8A%E9%85%8D%E9%A5%B0/%E5%A5%B3%E5%A3%AB","linktext":"秘密花园2"},{"imgsrc":"http://bs.baidu.com/lego-mat/373a7f06-1135-4bc0-adc1-6f96352e71ba_127_135.jpg","imgurl":"http://www.dior.cn/file/site/oneessentialcn/index.html","linktext":"护肤"},{"imgsrc":"http://bs.baidu.com/lego-mat/fbd1caf1-6697-445a-9716-f7318bfd18d9_127_135.jpg","imgurl":"http://www.dior.com/couture/ch_cn/%E7%8F%A0%E5%AE%9D-%E4%B8%8E%E8%85%95%E8%…aidu&utm_medium=brandzone&utm_term=%E8%85%95%E8%A1%A8&utm_campaign=Rorate4","linktext":"腕表"},{"imgsrc":"http://bs.baidu.com/lego-mat/c4d14a28-9fe6-4c68-9ef8-fbe969861e0d_127_135.jpg","imgurl":"http://www.dior.cn/beauty/chn/zh/minisite/th/dior_addict/index.html?utm_source=baidu&utm_medium=brandzone&utm_term=AddictGloss&utm_campaign=Rotate5","linktext":"彩妆"},{"imgsrc":"http://bs.baidu.com/lego-mat/4eed1eee-24b0-465b-82a4-8e2ad7d62a86_127_135.jpg","imgurl":"http://www.dior.com/couture/ch_cn/%E7%8F%A0%E5%AE%9D-%E4%B8%8E%E8%85%95%E8%…aidu&utm_medium=brandzone&utm_term=%E7%8F%A0%E5%AE%9D&utm_campaign=Rorate6","linktext":"珠宝"},{"imgsrc":"http://bs.baidu.com/lego-mat/5515b6a8-2cac-4bc7-89f2-f3e5580eb300_127_135.jpg","imgurl":"http://www.dior.com/couture/ch_cn/%E6%97%B6%E8%A3%85-%E5%8F%8A%E9%85%8D%E9%…aidu&utm_medium=brandzone&utm_term=%E7%94%B7%E5%A3%AB&utm_campaign=Rorate7","linktext":"男士"},{"imgsrc":"http://bs.baidu.com/lego-mat/9e8526d6-c829-4db9-b8be-104ca800fcd7_127_135.jpg","imgurl":"http://m.dior.com?utm_source=baidu&utm_medium=Brandzone&utm_term=%E7%A7%BB%E5%8A%A8%E5%AE%98%E7%BD%91&utm_campaign=Rorate8","linktext":"移动官网"}],"left_arrow":"http://bs.baidu.com/adtest/dc1e8d34e51bb836b47c73faa8484d76.png","right_arrow":"http://bs.baidu.com/adtest/d353670c47170fb32dd97b2dc87dbdfb.png"}};

        // jsonPath == null
        var result = ad.plugin.FilterRunner.runByIndex(0, data, spec, null, 123);
        deepEqual(result[0], {
            'type': 'url',
            'value': 'http://bs.baidu.com/lego-mat/52f501cf-a757-44e1-84bd-56c9f62206d3_220_164.jpg'
        });
        deepEqual(result[4], {
            'type': 'text',
            'value': '<em>Dior</em>迪奥中国官方网站'
        });

        // jsonPath query
        var result = ad.plugin.FilterRunner.runByIndex(
            0,
            data,
            spec,
            [
                "$.1.logoimg.logourl_rcv_url",
                "$.2.icon_url",
                "$.3.options[*].text"
            ],
            123
        );
        deepEqual(result[0], {
            'type': 'url',
            'value': 'http://www.baidu.com'
        });
        deepEqual(result[1], {
            'type': 'url',
            'value': 'http://e.weibo.com/2130860695/z5aF9D63Y'
        });
        deepEqual(result[3], {
            'type': 'text',
            'value': '新浪微博'
        });

        var spec = [{"name":"0","displayName":"spec_ut","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"html_test_rcv_html","displayName":"富文本","defaultValue":"","tip":"标题为6~30个汉字，核心<em>飘红词</em>最多可选6个汉字","datatype":"HTML","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{"required":true,"minTextByteLength":12,"maxTextByteLength":60,"tagList":{"em":{"maxTextByteLength":12,"minCount":1,"maxCount":1},"a":{"maxTextByteLength":12,"maxCount":5}}},"extraAttr":{"editorConfig":{"tools":["emphasize","link"]},"tagList":{"em":{"isAllowNoContent":false,"isSimpleTag":false},"a":{"attributeRules":{"target":{"isRequired":false,"isAllowNoValue":false,"defaultValue":"_blank"},"href":{"isRequired":true,"isAllowNoValue":false,"valueType":"url"}},"requiredAttributes":["target","href"],"isAllowNoContent":false,"isSimpleTag":false}}},"multiline":false},{"name":"string_test","displayName":"字符串","defaultValue":"http://","tip":"","datatype":"STRING","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{"required":true,"stringType":"URL"},"extraAttr":{},"multiline":false},{"name":"boolean_test","displayName":"BOOLEAN测试","defaultValue":"1","tip":"","datatype":"BOOL","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{},"extraAttr":{}},{"name":"enum_test","displayName":"枚举类型","defaultValue":"gbk","datatype":"ENUM","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{},"extraAttr":{},"enumValues":[{"value":"utf-8","displayValue":"UTF-8编码"},{"value":"gbk","displayValue":"GBK编码"}]},{"name":"hidden_test","displayName":"隐藏参数","defaultValue":"1238676432187","datatype":"HIDDEN","rules":{},"extraAttr":{}},{"name":"upload_test","displayName":"上传","defaultValue":"","tip":"","datatype":"UPLOAD","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","width":75,"height":75,"maxSize":5,"ext":"jpg,gif,png"}},{"name":"alternative_test","displayName":"可选表单","defaultValue":"upload","datatype":"ALTERNATIVE","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{},"extraAttr":{},"enumValues":[{"value":"upload","displayValue":"上传背景","items":[{"name":"upload_in_alternative_test","displayName":"上传","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","width":75,"height":75,"maxSize":5,"ext":"jpg,gif,png"}}]},{"value":"color","displayValue":"背景色","items":[{"name":"background_color","displayName":"背景颜色","defaultValue":"ffffff","tip":"颜色值为6位十六进制数","datatype":"STRING","rules":{"required":true,"minByteLength":6,"maxByteLength":6},"extraAttr":{},"multiline":false}]}]},{"name":"grid_test","displayName":"表格","defaultValue":"","tip":"","datatype":"GRID","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{},"extraAttr":{"rowRange":[2,9],"colRange":[3,5]},"multiline":false,"headCell":[{"name":"string_test","displayName":"字符串","defaultValue":"http://","tip":"","datatype":"STRING","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{"required":true,"stringType":"URL"},"extraAttr":{},"multiline":false}],"dataCell":[{"name":"string_test","displayName":"字符串","defaultValue":"http://","tip":"","datatype":"STRING","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{"required":true,"stringType":"URL"},"extraAttr":{},"multiline":false},{"name":"upload_test","displayName":"上传","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","width":75,"height":75,"maxSize":5,"ext":"jpg,gif,png"}}]},{"name":"object_test","displayName":"对象","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{},"extraAttr":{},"items":[{"name":"string_in_object_test","displayName":"按钮文本","defaultValue":"","tip":"","datatype":"STRING","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{"required":true,"maxByteLength":8},"extraAttr":{},"multiline":false},{"name":"upload_in_object_test","displayName":"上传","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","width":75,"height":75,"maxSize":5,"ext":"jpg,gif,png"}}]},{"name":"list_test","displayName":"列表","defaultValue":"","tip":"","datatype":"LIST","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{"minCount":3,"maxCount":5},"extraAttr":{},"display":"","items":[{"name":"string_in_list_test","displayName":"文字","defaultValue":"","tip":"20字节内","datatype":"STRING","nameTip":"-name-tip-","descriptionTip":"-description-tip-","rules":{"required":true,"maxByteLength":20},"extraAttr":{},"multiline":false},{"name":"upload_in_object_test","displayName":"上传","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","width":75,"height":75,"maxSize":5,"ext":"jpg,gif,png"}}]}]}];
        var data = {"0":{"html_test_rcv_html":"富文本<em>文本</em>test123","string_test":"http://www.baidu.com","boolean_test":true,"enum_test":"gbk","hidden_test":"1238676432187","upload_test":"http://bcs-sandbox.baidu.com/lego-mat/c66215f1-2237-42c2-bca4-701cbead2e0e_75_75.jpg","alternative_test":{"color":{"background_color":"FEFEFE"}},"grid_test":[[{"string_test":"http://grid00.www.baidu.com"},{"string_test":"http://grid01.www.baidu.com"},{"string_test":"http://grid02.www.baidu.com"}],[{"string_test":"http://grid10.www.baidu.com","upload_test":"http://grid10.bcs-sandbox.baidu.com/lego-mat/917ca055-9f97-491e-a4a6-f594c6a342cf_75_75.jpg"},{"string_test":"http://grid11.www.baidu.com","upload_test":"http://grid11.bcs-sandbox.baidu.com/lego-mat/917ca055-9f97-491e-a4a6-f594c6a342cf_75_75.jpg"},{"string_test":"http://grid12.www.baidu.com","upload_test":"http://grid12.bcs-sandbox.baidu.com/lego-mat/917ca055-9f97-491e-a4a6-f594c6a342cf_75_75.jpg"}]],"object_test":{"string_in_object_test":"按钮文本","upload_in_object_test":"http://bcs-sandbox.baidu.com/lego-mat/2b402c0a-7665-4b49-8e90-d7d1a81f4b20_75_75.jpg"},"list_test":[{"string_in_list_test":"列表1文字","upload_in_object_test":"http://bcs-sandbox.baidu.com/lego-mat/9f3d16c7-ae3a-4f2f-9db2-55fe9b3bc2a2_75_75.jpg"},{"string_in_list_test":"列表2文字","upload_in_object_test":"http://bcs-sandbox.baidu.com/lego-mat/955a3794-2813-44c4-87b7-476f6c03ab13_75_75.jpg"},{"string_in_list_test":"列表3文字","upload_in_object_test":"http://bcs-sandbox.baidu.com/lego-mat/917ca055-9f97-491e-a4a6-f594c6a342cf_75_75.jpg"}]}};
        var result = ad.plugin.FilterRunner.runByIndex(
            0,
            data,
            spec,
            [
                "$.0.html_test_rcv_html", // html
                "$.0.boolean_test", // bool: XXX: cannot find, because akafilter doesn't take bool
                "$.0.alternative_test.color.background_color", // alternative
                "$.0.grid_test[0][*].string_test", // grid: table head
                "$.0.grid_test[1:][*].upload_test", // grid: table data
                "$.0.object_test.string_in_object_test", // object
                "$.0.list_test[*].string_in_list_test" // list
            ],
            123
        );
        deepEqual(result[0], {
            'type': 'text',
            'value': '富文本<em>文本</em>test123'
        });
        deepEqual(result[1], {
            'type': 'text',
            'value': 'FEFEFE'
        });
        deepEqual(result[2], {
            'type': 'text',
            'value': 'http://grid00.www.baidu.com'
        });
        deepEqual(result[3], {
            'type': 'text',
            'value': 'http://grid01.www.baidu.com'
        });
        deepEqual(result[4], {
            'type': 'text',
            'value': 'http://grid02.www.baidu.com'
        });
        deepEqual(result[5], {
            'type': 'text',
            'value': 'http://grid10.bcs-sandbox.baidu.com/lego-mat/917ca055-9f97-491e-a4a6-f594c6a342cf_75_75.jpg'
        });
        deepEqual(result[6], {
            'type': 'text',
            'value': 'http://grid11.bcs-sandbox.baidu.com/lego-mat/917ca055-9f97-491e-a4a6-f594c6a342cf_75_75.jpg'
        });
        deepEqual(result[7], {
            'type': 'text',
            'value': 'http://grid12.bcs-sandbox.baidu.com/lego-mat/917ca055-9f97-491e-a4a6-f594c6a342cf_75_75.jpg'
        });
        deepEqual(result[8], {
            'type': 'text',
            'value': '按钮文本'
        });
        deepEqual(result[9], {
            'type': 'text',
            'value': '列表1文字'
        });
        deepEqual(result[10], {
            'type': 'text',
            'value': '列表2文字'
        });
        deepEqual(result[11], {
            'type': 'text',
            'value': '列表3文字'
        });
    });

    test('ad.plugin.DefensorFilter', function() {
        var spec = [{"name":"0","displayName":"播放器模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"img_url","displayName":"首帧图片","tip":"视频首帧图片","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","width":220,"height":164,"maxSize":30,"ext":"jpg,jpeg"}},{"name":"video_url","displayName":"视频文件","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"FLV","width":220,"height":164,"maxSize":700,"ext":"flv"}},{"name":"rcv_url","displayName":"视频跳转地址","datatype":"STRING","descriptionTip":"视频点击跳转地址","rules":{"required":true,"maxByteLength":255,"stringType":"URL"}},{"name":"ipad_img","displayName":"ipad显示图片","datatype":"UPLOAD","extraAttr":{"fileType":"IMAGE","maxSize":30,"ext":"jpg,jpeg"},"multiline":false},{"name":"player_ver","displayName":"播放器版本","defaultValue":"5","datatype":"HIDDEN","extraAttr":{"filters":"int"}},{"name":"width","displayName":"视频宽度","defaultValue":"220","datatype":"HIDDEN","extraAttr":{"filters":"int"}},{"name":"height","displayName":"视频高度","defaultValue":"190","datatype":"HIDDEN","extraAttr":{"filters":"int"}},{"name":"is_play","displayName":"是否自动播放","defaultValue":"false","datatype":"HIDDEN","extraAttr":{"filters":"bool"}}]},{"name":"1","displayName":"头部模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"titletext","displayName":"标题","defaultValue":"","tip":"<em>标题</em>为5~10个汉字","datatype":"HTML","nameTip":"(核心飘红词最多6个汉字)","rules":{"required":true,"minTextByteLength":10,"maxTextByteLength":20,"tagList":{"em":{"maxTextByteLength":12,"minCount":1,"maxCount":1}}},"extraAttr":{"editorConfig":{"tools":["emphasize"]},"tagList":{"em":{"isAllowNoContent":false,"isSimpleTag":false}}},"multiline":false},{"name":"titleurl_rcv_url","displayName":"跳转地址","defaultValue":"http://","tip":"","datatype":"STRING","rules":{"required":true,"stringType":"URL"},"multiline":false},{"name":"description","displayName":"描述","defaultValue":"","tip":"描述为45~60个汉字，<a href=\"http://fake.com\">链接词</a>最多5个，每个链接词最多6个汉字","datatype":"HTML","nameTip":"","descriptionTip":"","rules":{"required":true,"minTextByteLength":90,"maxTextByteLength":120,"tagList":{"a":{"maxTextByteLength":12,"maxCount":5}}},"extraAttr":{"editorConfig":{"tools":["link"]},"tagList":{"a":{"attributeRules":{"target":{"isRequired":false,"isAllowNoValue":false,"defaultValue":"_blank"},"href":{"isRequired":true,"isAllowNoValue":false,"valueType":"url"}},"requiredAttributes":["target","href"],"isAllowNoContent":false,"isSimpleTag":false}}},"multiline":true,"display":""},{"name":"site","displayName":"官网地址","defaultValue":"","tip":"最多可填写24字节","datatype":"STRING","rules":{"required":true,"maxByteLength":24},"multiline":false},{"name":"logoimg","displayName":"LOGO","datatype":"OBJECT","rules":{},"items":[{"name":"logoimg","displayName":"LOGO图片(可选)","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{},"extraAttr":{"fileType":"IMAGE","width":108,"height":14,"maxSize":5,"ext":"jpg"}},{"name":"logourl_rcv_url","displayName":"LOGO跳转地址(可选)","defaultValue":"","tip":"","datatype":"STRING","rules":{"stringType":"URL"},"multiline":false}]}]},{"name":"2","displayName":"微博模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"id","displayName":"微博个人资料页地址(或微博ID)","defaultValue":"","datatype":"STRING","descriptionTip":"sina微博个人资料页地址，如：\"http://*.weibo.com/2525235360/info?from=profile&wvr=5&loc=tabinf#profile_tab\"，或其中的“2525235360”微博ID","rules":{"required":true},"multiline":false},{"name":"name","displayName":"微博名称(可选)","defaultValue":"","datatype":"STRING","descriptionTip":"此项可不填，如不填则自动根据微博ID获取微博名称","rules":{},"multiline":false},{"name":"icon","displayName":"微博图标(可选)","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{},"extraAttr":{"fileType":"IMAGE","width":18,"height":18,"maxSize":25,"ext":"jpg,gif,png"},"multiline":false},{"name":"icon_url","displayName":"微博图标跳转地址(可选)","defaultValue":"","tip":"http://","datatype":"STRING","rules":{"stringType":"URL"},"multiline":false},{"name":"verify_img","displayName":"认证图标","defaultValue":"","tip":"","datatype":"HIDDEN","rules":{},"extraAttr":{"fileType":"IMAGE","width":14,"height":12,"maxSize":25,"ext":"jpg,gif,png"},"multiline":false},{"name":"follow_imgsrc","displayName":"加关注图标","defaultValue":"http://bs.baidu.com/adtest/c657a94c8803b67b903a42c7598fa63f.jpg","tip":"","datatype":"HIDDEN","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","maxSize":25,"ext":"jpg,gif,png"},"multiline":false},{"name":"weibo_logo_url","displayName":"微博LOGO跳转地址","defaultValue":"","tip":"http://","datatype":"HIDDEN","rules":{"stringType":"URL"},"multiline":false},{"name":"weibo_logo","displayName":"微博LOGO","defaultValue":"","tip":"","datatype":"HIDDEN","rules":{},"extraAttr":{"fileType":"IMAGE","maxSize":50,"ext":"jpg,gif,png"},"multiline":false},{"name":"weibo_context_length","displayName":"微博内容字节长度","defaultValue":"80","datatype":"HIDDEN","descriptionTip":"微博内容不超过160字节(1汉字=2字节)","extraAttr":{"filters":"int"},"multiline":false},{"name":"is_display_icon","displayName":"是否显示微博图标","defaultValue":"true","datatype":"HIDDEN","rules":{},"extraAttr":{"filters":"bool"}},{"name":"is_display_fans","displayName":"是否显示粉丝数","defaultValue":"true","datatype":"BOOL","rules":{}},{"name":"is_display_weibo","displayName":"是否显示微博数","defaultValue":"true","datatype":"BOOL","rules":{}},{"name":"is_display_foot","displayName":"是否显示日期、转发、收藏、评论","defaultValue":"true","datatype":"BOOL","rules":{}}]},{"name":"3","displayName":"多按钮模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"options","displayName":"链接列表","datatype":"LIST","rules":{"minCount":3,"maxCount":6},"items":[{"name":"text","displayName":"推广名","defaultValue":"官方微博","datatype":"STRING","rules":{"required":true,"maxByteLength":10}},{"name":"url","displayName":"链接","defaultValue":"http://","datatype":"STRING","rules":{"required":true,"maxByteLength":255,"stringType":"URL"}}]}]},{"name":"4","displayName":"胶带模块","defaultValue":"","tip":"","datatype":"OBJECT","nameTip":"","descriptionTip":"","rules":{},"extraAttr":{},"display":"toggle-block","items":[{"name":"disable","displayName":"不显示左右箭头","defaultValue":"false","tip":"","datatype":"HIDDEN","nameTip":"选中不显示左右箭头,取消选中显示左右箭头","rules":{},"extraAttr":{"filters":"bool"}},{"name":"image_width","displayName":"胶带图宽度","defaultValue":"127","tip":"","datatype":"HIDDEN","rules":{"stringType":"NUMBER"},"extraAttr":{"filters":"float"},"multiline":false},{"name":"image_margin","displayName":"胶带图间距","defaultValue":"5","tip":"","datatype":"HIDDEN","rules":{"stringType":"NUMBER"},"extraAttr":{"filters":"float"},"multiline":false},{"name":"speed","displayName":"胶带图片步进间隔时间(毫秒)","defaultValue":"25","datatype":"HIDDEN","rules":{"stringType":"NUMBER"},"extraAttr":{"filters":"float"},"multiline":false},{"name":"options","displayName":"图片项","tip":"图片列表","datatype":"LIST","rules":{"required":true,"minCount":5,"maxCount":10},"items":[{"name":"imgsrc","displayName":"图片地址","defaultValue":"","tip":"","datatype":"UPLOAD","rules":{"required":true},"extraAttr":{"fileType":"IMAGE","width":127,"height":135,"maxSize":10,"ext":"jpg,jpeg"}},{"name":"imgurl","displayName":"图片点击URL","defaultValue":"http://","tip":"图片点击URL","datatype":"STRING","rules":{"required":true,"maxByteLength":255,"stringType":"URL"}},{"name":"linktext","displayName":"图片描述文本","tip":"5个汉字内","datatype":"STRING","rules":{"required":true,"maxByteLength":10}}]},{"name":"left_arrow","displayName":"向左箭头图标","defaultValue":"http://bs.baidu.com/adtest/dc1e8d34e51bb836b47c73faa8484d76.png","tip":"向左箭头图标","datatype":"HIDDEN","rules":{"stringType":"URL"},"extraAttr":{},"multiline":false},{"name":"right_arrow","displayName":"向右箭头图标","defaultValue":"http://bs.baidu.com/adtest/d353670c47170fb32dd97b2dc87dbdfb.png","tip":"向右箭头图标","datatype":"HIDDEN","rules":{"stringType":"URL"},"extraAttr":{},"multiline":false}]}];
        var data = {"0":{"img_url":"http://bs.baidu.com/lego-mat/52f501cf-a757-44e1-84bd-56c9f62206d3_220_164.jpg","video_url":"http://bs.baidu.com/lego-mat/bb759ae8-fae9-4830-ba1b-cc6da5c1f0ff.flv","rcv_url":"http://v.youku.com/v_show/id_XNTY2Njg0MDgw.html?utm_source=baidu&utm_medium=brandzone&utm_term=MyDiorVideo&utm_campaign=VideoPic","ipad_img":"","player_ver":5,"width":220,"height":190,"is_play":false},"1":{"titletext":"<em>Dior</em>迪奥中国官方网站","titleurl_rcv_url":"http://www.dior.com/home/ch_cn/?utm_source=baidu&utm_medium=brandzone&utm_t…9%E4%B8%AD%E5%9B%BD%E5%AE%98%E6%96%B9%E7%BD%91%E7%AB%99&utm_campaign=Title","description":"Dior迪奥，由同名时装大师创造，半个世纪以来，不断演绎时尚魅惑，在<a target=\"_blank\" href=\"http://www.dior.com/couture/ch_cn/%E6%97%B6%E8%A3%85-%E5%8F%8A%E9%85%8D%E9%…m=brandzone&amp;utm_term=%E6%97%B6%E8%A3%85&amp;utm_campaign=Description1\">时装</a>、<a target=\"_blank\" href=\"http://www.dior.com/home/ch_cn/?utm_source=baidu&amp;utm_medium=brandzone&a…7%8F%A0%E5%AE%9D%E5%8F%8A%E6%89%8B%E8%A1%A8&amp;utm_campaign=Description2\">珠宝及手表</a>、<a target=\"_blank\" href=\"http://www.dior.cn/beauty/chn/zh/parfum/xfragrance.html?utm_source=baidu&am…m=brandzone&amp;utm_term=%E9%A6%99%E6%B0%B4&amp;utm_campaign=Description3\">香水</a>、<a target=\"_blank\" href=\"http://www.dior.cn/beauty/chn/zh/%E5%BD%A9%E5%A6%86/xmakeup.html?utm_source…m=brandzone&amp;utm_term=%E5%BD%A9%E5%A6%86&amp;utm_campaign=Description4\">彩妆</a>和<a target=\"_blank\" href=\"http://www.dior.cn/beauty/chn/zh/%E6%8A%A4%E8%82%A4/xskincare.html?utm_sour…m=brandzone&amp;utm_term=%E6%8A%A4%E8%82%A4&amp;utm_campaign=Description5\">护肤</a>领域，缔造品牌神话！","site":"Dior.com","logoimg":{"logoimg":"","logourl_rcv_url":"http://www.baidu.com"}},"2":{"id":"http://e.weibo.com/2130860695/z5aF9D63Y","name":"","icon":"","icon_url":"http://e.weibo.com/2130860695/z5aF9D63Y","verify_img":"","follow_imgsrc":"http://bs.baidu.com/adtest/c657a94c8803b67b903a42c7598fa63f.jpg","weibo_logo_url":"http://e.weibo.com/2130860695/z5aF9D63Y","weibo_logo":"","weibo_context_length":80,"is_display_icon":true,"is_display_fans":true,"is_display_weibo":true,"is_display_foot":true},"3":{"options":[{"text":"DiorMAG","url":"http://www.dior.com/magazine/ch_cn?utm_source=baidu&utm_medium=brandzone&utm_term=DiorMAG&utm_campaign=Tab1"},{"text":"新浪微博","url":"http://e.weibo.com/dior?utm_source=baidu&utm_medium=brandzone&utm_term=%E6%96%B0%E6%B5%AA%E5%BE%AE%E5%8D%9A&utm_campaign=Tab2"},{"text":"优酷主页","url":"http://u.youku.com/user_show/uid_Dior?utm_source=baidu&utm_medium=brandzone&utm_term=%E4%BC%98%E9%85%B7%E4%B8%BB%E9%A1%B5&utm_campaign=Tab4"},{"text":"iPhone应用","url":"https://itunes.apple.com/us/app/dior/id315312415?mt=8&utm_source=baidu&utm_medium=brandzone&utm_term=iPhone%E5%BA%94%E7%94%A8&utm_campaign=Tab5"},{"text":"开心主页","url":"http://www.kaixin001.com/dior?utm_source=baidu&utm_medium=brandzone&utm_term=%E5%BC%80%E5%BF%83%E4%B8%BB%E9%A1%B5&utm_campaign=Tab3"}]},"4":{"disable":false,"image_width":127,"image_margin":5,"speed":25,"options":[{"imgsrc":"http://bs.baidu.com/lego-mat/a556d19f-12cf-41b3-8d35-f7c8763d971d_127_135.jpg","imgurl":"http://www.dior.cn/beauty/chn/zh/fragrance/%E5%A5%B3%E9%A6%99/dior_addict/l…aidu&utm_medium=brandzone&utm_term=Addict%20Fragrance&utm_campaign=Rotate1","linktext":"香氛"},{"imgsrc":"http://bs.baidu.com/lego-mat/e8e54d0d-b1df-47f5-b0fd-49ea5edcda98_127_135.jpg","imgurl":"http://www.dior.com/couture/ch_cn/%E6%97%B6%E8%A3%85-%E5%8F%8A%E9%85%8D%E9%A5%B0/%E5%A5%B3%E5%A3%AB","linktext":"秘密花园2"},{"imgsrc":"http://bs.baidu.com/lego-mat/373a7f06-1135-4bc0-adc1-6f96352e71ba_127_135.jpg","imgurl":"http://www.dior.cn/file/site/oneessentialcn/index.html","linktext":"护肤"},{"imgsrc":"http://bs.baidu.com/lego-mat/fbd1caf1-6697-445a-9716-f7318bfd18d9_127_135.jpg","imgurl":"http://www.dior.com/couture/ch_cn/%E7%8F%A0%E5%AE%9D-%E4%B8%8E%E8%85%95%E8%…aidu&utm_medium=brandzone&utm_term=%E8%85%95%E8%A1%A8&utm_campaign=Rorate4","linktext":"腕表"},{"imgsrc":"http://bs.baidu.com/lego-mat/c4d14a28-9fe6-4c68-9ef8-fbe969861e0d_127_135.jpg","imgurl":"http://www.dior.cn/beauty/chn/zh/minisite/th/dior_addict/index.html?utm_source=baidu&utm_medium=brandzone&utm_term=AddictGloss&utm_campaign=Rotate5","linktext":"彩妆"},{"imgsrc":"http://bs.baidu.com/lego-mat/4eed1eee-24b0-465b-82a4-8e2ad7d62a86_127_135.jpg","imgurl":"http://www.dior.com/couture/ch_cn/%E7%8F%A0%E5%AE%9D-%E4%B8%8E%E8%85%95%E8%…aidu&utm_medium=brandzone&utm_term=%E7%8F%A0%E5%AE%9D&utm_campaign=Rorate6","linktext":"珠宝"},{"imgsrc":"http://bs.baidu.com/lego-mat/5515b6a8-2cac-4bc7-89f2-f3e5580eb300_127_135.jpg","imgurl":"http://www.dior.com/couture/ch_cn/%E6%97%B6%E8%A3%85-%E5%8F%8A%E9%85%8D%E9%…aidu&utm_medium=brandzone&utm_term=%E7%94%B7%E5%A3%AB&utm_campaign=Rorate7","linktext":"男士"},{"imgsrc":"http://bs.baidu.com/lego-mat/9e8526d6-c829-4db9-b8be-104ca800fcd7_127_135.jpg","imgurl":"http://m.dior.com?utm_source=baidu&utm_medium=Brandzone&utm_term=%E7%A7%BB%E5%8A%A8%E5%AE%98%E7%BD%91&utm_campaign=Rorate8","linktext":"移动官网"}],"left_arrow":"http://bs.baidu.com/adtest/dc1e8d34e51bb836b47c73faa8484d76.png","right_arrow":"http://bs.baidu.com/adtest/d353670c47170fb32dd97b2dc87dbdfb.png"}};

        // jsonPath == null
        var result = ad.plugin.FilterRunner.runByIndex(1, data, spec, null, 123);
        deepEqual(result[0], {
            'key': '0.img_url',
            'name': '播放器模块_首帧图片',
            'type': 'url',
            'value': 'http://bs.baidu.com/lego-mat/52f501cf-a757-44e1-84bd-56c9f62206d3_220_164.jpg'
        });
        deepEqual(result[4], {
            'key': '0.player_ver',
            'name': '播放器模块_播放器版本',
            'type': 'number',
            'value': 5
        });
    });

    test('ad.plugin.PickValueFilter', function() {
        var data = {
            "cid": {
                "logo_src": 'http://ecma.bdimg.com/adtest/b41b87df0542383e797648a31ede17ed.jpg',
                "company_name": "北京新东方学校",
                "company_rcv_url": "http://bj.xdf.cn/"
            },
            "product": {
                "company_title": "企业产品",
                "products": [
                    {
                        "img_src": "http://ecma.bdimg.com/adtest/9aa35e5ea00be8e3bb99c2f47db9a0d6.jpg",
                        "rcv_url": "http://bj.xdf.cn/publish/portal24/tab19380/?utm_source=baidu&utm_medium=banner&utm_term=toefl&utm_content=tupianyangshi&utm_campaign=zhidaowenda",
                        "text": "TOEFL培训 超强师资"
                    },
                    {
                        "img_src": "http://ecma.bdimg.com/adtest/1af3e2d0d4fac611f50931a27bd99a89.jpg",
                        "rcv_url": "http://bj.xdf.cn/publish/portal24/tab19373/?utm_source=baidu&utm_medium=banner&utm_term=ielts&utm_content=tupianyangshi&utm_campaign=zhidaowenda",
                        "text": "领航IELTS培训"
                    },
                    {
                        "img_src": "http://ecma.bdimg.com/adtest/1ad751fe0217dfb530dee1615493add3.jpg",
                        "rcv_url": "http://bj.xdf.cn/publish/portal24/tab19381/?utm_source=baidu&utm_medium=banner&utm_term=xingainian&utm_content=tupianyangshi&utm_campaign=zhidaowenda",
                        "text": "新概念英语 必修课"
                    },
                    {
                        "img_src": "http://ecma.bdimg.com/adtest/ba24a9c575373cbb574a55a099e78934.jpg",
                        "rcv_url": "http://bj.xdf.cn/publish/portal24/tab19421/?utm_source=baidu&utm_medium=banner&utm_term=siliuji&utm_content=tupianyangshi&utm_campaign=zhidaowenda",
                        "text": "丰收四六级高分"
                    }
                ]
            },
            "related": {
                "related_title": "相关知识",
                "related_list": [
                    {
                        "text": '如何提升听说读写译能力？',
                        "rcv_url": 'http://bj.xdf.cn/publish/portal24/tab16991/info813769.htm?utm_source=baidu&utm_medium=banner&utm_term=1&utm_content=xiangguanzhishi&utm_campaign=zhidaowenda'
                    },
                    {
                        "text": '经典英文结婚祝福语口语',
                        "rcv_url": 'http://bj.xdf.cn/publish/portal24/tab16991/info813642.htm?utm_source=baidu&utm_medium=banner&utm_term=2&utm_content=xiangguanzhishi&utm_campaign=zhidaowenda'
                    },
                    {
                        "text": '如何看视频学习英语？',
                        "rcv_url": 'http://bj.xdf.cn/publish/portal24/tab16991/info813267.htm?utm_source=baidu&utm_medium=banner&utm_term=3&utm_content=xiangguanzhishi&utm_campaign=zhidaowenda'
                    },
                    {
                        "text": '常坐飞机的人需要学的口语',
                        "rcv_url": 'http://bj.xdf.cn/publish/portal24/tab16991/info812960.htm?utm_source=baidu&utm_medium=banner&utm_term=4&utm_content=xiangguanzhishi&utm_campaign=zhidaowenda'
                    }
                ]
            }
        };
        var params = {
            'key': 'company_name'
        };
        var result = ad.plugin.FilterRunner.runByIndex(2, data, params);
        deepEqual(result[0], '北京新东方学校');
    });
}

ad.Debug(main);
</script>
</body>
</html>
