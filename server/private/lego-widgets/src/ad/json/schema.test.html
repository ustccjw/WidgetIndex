<!doctype html>
<!--
/***************************************************************************
 *
 * Copyright (c) 2012 Baidu.com, Inc. All Rights Reserved
 * $Id: schema.test.html 13329 2012-10-26 01:02:01Z songao $
 *
 **************************************************************************/



/**
 * src/ad/json/schema_test.html ~ 2012/05/10 10:49:04
 * @author liyubei@baidu.com (liyubei)
 * @version $Revision: 13329 $ 
 * @description
 *
 **/
-->
<html>
<head>
    <meta charset="utf-8" />
    <title>Schema Test</title>
    <script type="text/javascript" src="../../../assets/js/tangram-base-1.3.7.1.js"></script>
    <script type="text/javascript" src="../../base.js"></script>
    <script type="text/javascript">
        goog.require('ad.Debug');
        goog.require('ad.json.Schema');
        goog.require('third_party.qunit.Qunit');
    </script>
</head>
<body>
  <div id="qunit"></div>
</body>
<script type="text/javascript">
function bootstrap() {
  var detector = new ad.json.Schema();

  test('format', function(){
    equal(detector.format(detector.guess({'name' : 'hello world'})),
      '<UserPref name="name" display_name="name" default_value="HELLO WORLD" datatype="string" />');
    equal(detector.format(detector.guess({'name_url' : 'hello world'})),
      '<UserPref name="name_url" display_name="name_url" default_value="http://www.baidu.com" datatype="url" />');
    equal(detector.format(detector.guess({'name_url' : 123})),
      '<UserPref name="name_url" display_name="name_url" default_value="8964" datatype="number" />');
    equal(detector.format(detector.guess({'name_url' : false})),
      '<UserPref name="name_url" display_name="name_url" default_value="true" datatype="boolean" />');
  });

  test('primitive types', function(){
    // 不考虑ty
    deepEqual(detector.guess({'name' : 'hello world'}), [[0, 'name', 'string']]);
    deepEqual(detector.guess({'name_url' : 'hello world'}), [[0, 'name_url', 'url']]);
    deepEqual(detector.guess({'name' : new String('hello world')}), [[0, 'name', 'string']]);
    deepEqual(detector.guess({'name' : 0}), [[0, 'name', 'number']]);
    deepEqual(detector.guess({'name_url' : 0}), [[0, 'name_url', 'number']]);
    deepEqual(detector.guess({'name' : 89.64}), [[0, 'name', 'number']]);
    deepEqual(detector.guess({'name' : Number(89.64)}), [[0, 'name', 'number']]);
    deepEqual(detector.guess({'name' : true}), [[0, 'name', 'boolean']]);
    deepEqual(detector.guess({'name' : false}), [[0, 'name', 'boolean']]);

    deepEqual(detector.guess('123'), [0, null, 'string']);
    deepEqual(detector.guess(true), [0, null, 'boolean']);
    deepEqual(detector.guess(123), [0, null, 'number']);
  });

  test('array types', function(){
    deepEqual(detector.guess({'name' : []}), [[2, 'name', [0, null, 'string']]]);
    deepEqual(detector.guess({'name' : [1, 2, '3']}), [[2, 'name', [0, null, 'number']]]);
    deepEqual(detector.guess({'name' : ['1', 2, '3']}), [[2, 'name', [0, null, 'string']]]);
    deepEqual(detector.guess({'name' : [true, false]}), [[2, 'name', [0, null, 'boolean']]]);
  });

  test('object types', function(){
    deepEqual(detector.guess({'name' : {}}), [[1, 'name', []]]);
    deepEqual(detector.guess({'foo' : {'name' : 'hello world'}}), [[1, 'foo', [[0, 'name', 'string']]]]);
  });

  test('an actual examples', function(){
    var instance = {
    'options' : [
        {
            'icon_url' : 'http://wangdawei.fe.baidu.com/icon-green.jpg',
            'text' : 'Pro-X特护修纹眼霜， 28天显著改善眼周问题言',
            'text_url' : 'www.baidu.com',
            'detail':'描述1',
            'is_ipad' : false,
            'time' : 1000,
            'sub_options' : [
                {
                  'text' : 'hello',
                  'link' : 'http://www.baidu.com'
                },
                {
                  'text' : 'world',
                  'link' : 'http://www.baidu.com'
                }
            ]
        },
        {
            'icon_url' : 'http://wangdawei.fe.baidu.com/icon-red.jpg',
            'text' : '每天加一勺纽崔莱蛋白质粉，补充蛋白质很简单',
            'text_url' : 'www.baidu.com',
            'detail':'描述2',
            'is_ipad' : false,
            'time' : 1000,
            'sub_options' : [
                {
                  'text' : 'hello',
                  'link' : 'http://www.baidu.com'
                },
                {
                  'text' : 'world',
                  'link' : 'http://www.baidu.com'
                }
            ]
        }
      ]
    };

    var schema = [
      [2, 'options', [
        [0, 'icon_url', 'url'],
        [0, 'text', 'string'],
        [0, 'text_url', 'url'],
        [0, 'detail', 'string'],
        [0, 'is_ipad', 'boolean'],
        [0, 'time', 'number'],
        [2, 'sub_options', [
          [0, 'text', 'string'],
          [0, 'link', 'string']
        ]]
      ]]
    ];

    deepEqual(detector.guess(instance), schema);
    equal(detector.format(schema),
      '<UserPref name="options" display_name="options" datatype="list">\n' +
        '<UserPref name="icon_url" display_name="icon_url" default_value="http://www.baidu.com" datatype="url" />\n' +
        '<UserPref name="text" display_name="text" default_value="HELLO WORLD" datatype="string" />\n' +
        '<UserPref name="text_url" display_name="text_url" default_value="http://www.baidu.com" datatype="url" />\n' +
        '<UserPref name="detail" display_name="detail" default_value="HELLO WORLD" datatype="string" />\n' +
        '<UserPref name="is_ipad" display_name="is_ipad" default_value="true" datatype="boolean" />\n' +
        '<UserPref name="time" display_name="time" default_value="8964" datatype="number" />\n' +
        '<UserPref name="sub_options" display_name="sub_options" datatype="list">\n' +
          '<UserPref name="text" display_name="text" default_value="HELLO WORLD" datatype="string" />\n' +
          '<UserPref name="link" display_name="link" default_value="HELLO WORLD" datatype="string" />\n' +
        '</UserPref>\n' +
      '</UserPref>');
  });

}

ad.Debug(bootstrap);
</script>
</html>
